registerNS("iv.setup.controller");iv.setup.controller={init:function(config){this.selector=config.selector;this.pageId=config.pageId;this.getUserSetupInfo();this.isMashup=config.isMashup;this.isUpdateRequest=false;this.setupSubscribeEvent();},setupSubscribeEvent:function(){iv.hub.subscribeToEvent("REFRESH_SETUP",this.refreshSetup,this);
iv.hub.subscribeToEvent("REMOVE_HIGHLIGHT_SETUP",this.removeHighlightSetup,this);iv.hub.subscribeToEvent("REFRESH_CONNECTION_COUNT",this.refreshConnectionCount,this);},removeHighlightSetup:function(data){if(iv.setup.controller.isKeyPresent(data.eventData)){iv.setup.renderer.removeHighlight(data.eventData);
}},refreshSetup:function(data){if(iv.setup.controller.isKeyPresent(data.eventData)){var isUpdateRequest=true;iv.setup.controller.getUserSetupInfo(isUpdateRequest);}},refreshConnectionCount:function(){iv.setup.renderer.refreshConnectionCount();},isKeyPresent:function(key){if(iv.setup.renderer.nodeIds[key]){return true;
}return false;},removeSetupFromStorage:function(){var storedHash=iv.util.getStorageItem("ivSetupHash");if(!storedHash){return false;}iv.util.removeStorageItem("ivSetupHash");iv.util.removeStorageItem(storedHash);},setSetupInStorage:function(resp){iv.setup.controller.removeSetupFromStorage();iv.util.setStorageItem("ivSetupHash",resp.data.setupHash);
iv.util.setStorageItem(resp.data.setupHash,resp);},getSetupFromStorage:function(){var storedHash=iv.util.getStorageItem("ivSetupHash");if(!storedHash){return false;}if(iv.user.data.setupMap.ivSetupHash===storedHash){var setupResponse=iv.util.getStorageItem(storedHash);iv.setup.controller.handleUserSetupInfoData(setupResponse,false);
return true;}else{iv.setup.controller.removeSetupFromStorage();}return false;},getUserSetupInfo:function(isUpdateRequest){if(typeof iv.user.data=="undefined"||typeof iv.user.data.setupMap=="undefined"||typeof iv.user.data.setupMap.setupStepId=="undefined"){return;}if(!iv.user.data.setupMap.showSetup&&!iv.user.data.setupMap.isConnectionPage){return;
}else{if(!iv.user.data.setupMap.showSetup&&iv.user.data.setupMap.isConnectionPage){if(!iv.isMashup){iv.setup.renderer.renderConnectionWidget(iv.setup.controller.selector);}return;}}if(!isUpdateRequest&&iv.setup.controller.getSetupFromStorage()){return;}iv.api.getJson({resource:"/iv/showSetup.iv",urlParams:{setupStepId:iv.user.data.setupMap.setupStepId==""?"-1":iv.user.data.setupMap.setupStepId},success:function(resp){iv.setup.controller.handleUserSetupInfoData(resp,isUpdateRequest);
},error:function(resp){iv.setup.controller.handleUserSetupInfoData(resp,isUpdateRequest);}});},handleUserSetupInfoData:function(resp,isUpdateRequest){if(!resp.error){iv.setup.controller.setSetupInStorage(resp);if(isUpdateRequest){iv.setup.renderer.updateWidget(resp.data,this.selector);}else{iv.setup.renderer.renderWidget(resp.data,this.selector);
}}}};