registerNS("iv.setup.renderer");iv.setup.renderer={treeNodeHoverMap:{},treeNodeHtml:"",nodeIds:{},setupCompleted:false,isConnectionPage:iv.user.data.setupMap.isConnectionPage,renderWidget:function(data,selector){if(data.setupCompletion==100){this.setupCompleted=true;var setupHtml=_.template(iv.ui.getTemplate("ivSetup.ivSetupCompleted"),{isMashup:iv.isMashup,isConnectionPage:this.isConnectionPage});
$(selector).html(setupHtml);if(!iv.isMashup&&this.isConnectionPage){this.initConnectionsCount();}return;}var element=$(selector);var headHtml=_.template(iv.ui.getTemplate("ivSetup.ivSetupHead"),{isMashup:iv.isMashup,setupCompletion:data.setupCompletion,expandSetup:data.expandSetup,data:data.ivSetupTree});
this.getTreeNodeHtml(data.ivSetupTree.children,false);var tailHtml=_.template(iv.ui.getTemplate("ivSetup.ivSetupTail"),{isMashup:iv.isMashup,data:data.ivSetupTree,expandSetup:data.expandSetup,isConnectionPage:this.isConnectionPage});var content=headHtml+this.treeNodeHtml+tailHtml;$(selector).html(content);
if(!iv.isMashup&&this.isConnectionPage){this.initConnectionsCount();}this.attachTooltips();this.attachEvents();},renderConnectionWidget:function(selector){var setupHtml=_.template(iv.ui.getTemplate("ivSetup.ivSetupConnectionBox"));$(selector).html(setupHtml);this.initConnectionsCount();},initConnectionsCount:function(){iv.api.getJson({resource:"/iv/getToDoData.iv",success:iv.setup.renderer.showConnectionsCount,error:iv.setup.renderer.showConnectionsCount});
},showConnectionsCount:function(resp){var connectionsHtml=_.template(iv.ui.getTemplate("ivSetup.connectionsCount"),{companyConnectionCount:iv.util.formatNumber(resp.data.companyConnectionCount),contactConnectionCount:iv.util.formatNumber(resp.data.contactConnectionCount)});$(".ivSetup .connectionCounts").html(connectionsHtml);
},refreshConnectionCount:function(){if($(".ivSetup .connectionCounts").length<=0){return;}var loadingHtml='<div class="connectedToContent" align="center">'+'<img src="/iv/common/styles/images/SmallLoadingAnimation.gif"/></div>';$(".ivSetup .connectionCounts").html(loadingHtml);this.initConnectionsCount();
},updateWidget:function(data,selector){var element=$(selector);$(selector).find(".setupBox .setupValue").html("Setup "+data.setupCompletion+"%");$(selector).find(".setupBox .progress .bar").width(data.setupCompletion+"%");this.treeNodeHtml="";iv.setup.renderer.nodeIds={};iv.setup.renderer.treeNodeHoverMap={};
if(data.setupCompletion==100){$(selector).find(".setupMenu").remove();}else{this.getTreeNodeHtml(data.ivSetupTree.children,false);$(selector).find(".setupMenu .menuContent .setupSteps").html(this.treeNodeHtml+'<div class="clearfix"></div>');this.attachTooltips();}},removeHighlight:function(id){$(".ivSetup .step#"+id).removeClass("highlighted");
},getTreeNodeHtml:function(nodes,hasParent){if(!nodes){return;}_.each(nodes,function(node){iv.setup.renderer.nodeIds[node.name]=true;if(node.hoverMessage&&(!node.children||node.children.length==0)&&!node.highlighted){iv.setup.renderer.treeNodeHoverMap[node.name]={hoverMessage:node.hoverMessage,nodeValue:node.displayName};
}if(node.highlighted){node.url="javascript:void(0);";}var treeNodeHtml=_.template(iv.ui.getTemplate("ivSetup.ivSetupTreeNode"),{isMashup:iv.isMashup,data:node,hasParent:hasParent,hasChildren:node.children&&node.children.length>0?true:false});iv.setup.renderer.treeNodeHtml+=treeNodeHtml;if(node.children&&node.children.length>0){iv.setup.renderer.getTreeNodeHtml(node.children,true);
}});},attachTooltips:function(){iv.util.require([iv.ui.getTemplate("commonRequires.toolTip")],function(){_.each(iv.setup.renderer.treeNodeHoverMap,function(hoverInfo,id){var config={selector:"#"+id,position:{at:"left center",corner:"right center",my:"right center",adjust:{x:5,method:"flip"}},messageContent:_.template(iv.ui.getTemplate("ivSetup.hoverMessage"),hoverInfo),dependencies:[]};
iv.toolTip.init(config);});});},sendCloseMenuRequest:function(){iv.setup.controller.removeSetupFromStorage();iv.api.getJson({resource:"/iv/updateExpandIVSetupFlag.iv",urlParams:{expandSetup:false},success:function(resp){},error:function(){}});},attachEventsToMenu:function(){$("body").delegate(".ivSetup","mouseleave",function(){if(iv.setup.renderer.isMenuHiding){return;
}iv.setup.renderer.isMenuHiding=true;$(".ivSetup .setupMenu").fadeOut(500,function(){iv.setup.renderer.isMenuHiding=false;});});$("body").delegate(".ivSetup .setupBox","mouseover",function(){if(iv.setup.renderer.isMenuShowing){return;}iv.setup.renderer.isMenuShowing=true;$(".ivSetup .setupMenu").fadeIn(500,function(){iv.setup.renderer.isMenuShowing=false;
});});$("body").delegate(".mainGreyBox","click",function(evt){if($(".ivSetup .setupMenu").is(":visible")&&$(evt.originalTarget).parents(".ivSetup").length==0){if(iv.setup.renderer.isMenuHiding){return;}iv.setup.renderer.isMenuHiding=true;$(".ivSetup .setupMenu").fadeOut(500,function(){iv.setup.renderer.isMenuHiding=false;
});}});},attachEvents:function(){if(iv.isMashup){if($(".ivSetup .setupMenu").hasClass("setupMenuClosed")){this.attachEventsToMenu();}else{$(".ivSetup .close #closeSetup").bind("click",function(){$(".ivSetup .setupMenu").fadeOut(500,function(){$(".ivSetup .setupMenu").addClass(".setupMenuClosed");$(".ivSetup .close").remove();
iv.setup.renderer.attachEventsToMenu();iv.setup.renderer.sendCloseMenuRequest();});});}}}};