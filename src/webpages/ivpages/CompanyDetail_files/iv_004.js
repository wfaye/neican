function ivTooltip(data){this.targetId=data.target;if(typeof data.target==="object"){this.target=data.target;}else{this.target=$("#"+this.targetId)[0];}this.contentWidth=data.width;this.tooltip=this.getTooltipContainer();this.makeItTooltip();this.contentReady=false;if(data.content){this.content=data.content;
this.contentReady=true;}if(data.dataSource){this.dataSource=data.dataSource;if(data.dataType){this.dataType=data.dataType;}if(data.template){this.template=data.template;}}if(typeof data.enforceHeight!=="undefined"){this.enforceHeight=data.enforceHeight;}this.lastHoverTimestamp=null;this.lastHoverDuration=0;
if(typeof data.tracking!=="undefined"){this.trackingComplete=false;this.trackingUrl=data.tracking.url;this.trackingDuration=typeof data.tracking.duration!="undefined"?data.tracking.duration:3;}if(data.prefetch){this.prefetch=data.prefetch;this.fetchContentFromSource();}this.currentSetPosition="";if(typeof data.enforcePosition!=="undefined"){if(data.enforcePosition==="left"||data.enforcePosition==="bottom"||data.enforcePosition==="top"||data.enforcePosition==="right"){this.enforcePosition=data.enforcePosition;
}else{alert("Invalid value for enforcePosition");}}if(data.displayCallback){this.displayCallback=data.displayCallback;}this.fetchInProgress=false;this.delay=10;if(data.delay){this.delay=data.delay;}this.timeOut=10;if(data.timeOut){this.timeOut=data.timeOut;}this.smallerFrame=false;if(data.smallerFrame){this.smallerFrame=true;
}this.keepAlive=false;this.shown=false;this.hideEvent=null;this.showEvent=null;this.onTarget=false;function destroyShowEvent(){clearTimeout(that.showEvent);}function destroyhideEvent(){clearTimeout(that.hideEvent);}function getTopAndLeft(){var rect=that.target.getBoundingClientRect();return{"top":parseInt(rect.top),"left":parseInt(rect.left),"right":parseInt(rect.right),"bottom":parseInt(rect.bottom),"height":parseInt(rect.bottom-rect.top),"width":parseInt(rect.right-rect.left)};
}function getWindowHeight(){var height=0;if(window.innerHeight){height=window.innerHeight;}else{if(document.documentElement&&document.documentElement.clientHeight){height=document.documentElement.clientHeight;}else{if(document.body){height=document.body.clientHeight;}}}return height;}function setTooltipPos(contentWidth,contentHeight){$("#tooltip-icon").removeClass();
var coord=getTopAndLeft();var scrollY=0,scrollWidth=0,scrollX=0;var height=0;var reorder=false;if(typeof contentHeight!="undefined"){height=getWindowHeight();reorder=(coord.top+contentHeight)>height;}if(typeof window.pageYOffset!="undefined"){scrollX=window.pageXOffset;scrollY=window.pageYOffset;scrollWidth=window.innerWidth;
}else{scrollX=document.documentElement.scrollLeft;scrollY=document.documentElement.scrollTop;scrollWidth=document.documentElement.scrollWidth;}$("#tooltip-icon").css({"top":"","left":""});if(typeof that.enforcePosition==="undefined"){if(that.smallerFrame){that.tooltip.style.top=0+"px";that.tooltip.style.left=0+"px";
that.tooltip.style.position="fixed";}else{if((coord.right+contentWidth)<=document.body.scrollWidth){$("#tooltip-icon").addClass("tooltip_corner_sprites left_tooltip");that.tooltip.style.left=(coord.right+5)+"px";if(reorder){$("#tooltip-icon").css("top",(contentHeight-10)+"px");that.tooltip.style.top=(coord.top+parseInt(coord.height/2)+scrollY-contentHeight)+"px";
}else{that.tooltip.style.top=(coord.top-40+parseInt(coord.height/2)+scrollY)+"px";}that.currentSetPosition="left";}else{if((coord.left-contentWidth)>0){$("#tooltip-icon").addClass("tooltip_corner_sprites right_tooltip");that.tooltip.style.left=(coord.left-contentWidth-50)+"px";if(reorder){$("#tooltip-icon").css("top",(contentHeight-10)+"px");
that.tooltip.style.top=(coord.top+parseInt(coord.height/2)+scrollY-contentHeight)+"px";}else{that.tooltip.style.top=(coord.top-40+parseInt(coord.height/2)+scrollY)+"px";}that.currentSetPosition="right";}else{if(coord.top+contentHeight<getWindowHeight()){$("#tooltip-icon").addClass("tooltip_corner_sprites bottom_tooltip");
that.tooltip.style.left=(coord.left-(contentWidth/2)+parseInt(coord.width/2)+scrollX)+"px";that.tooltip.style.top=(coord.top-contentHeight+scrollY-75)+"px";that.currentSetPosition="bottom";}else{$("#tooltip-icon").addClass("tooltip_corner_sprites top_tooltip");that.tooltip.style.left=(coord.left-(contentWidth/2)+parseInt(coord.width/2)+scrollX)+"px";
that.tooltip.style.top=(coord.bottom+scrollY)+"px";that.currentSetPosition="top";}}}}}if(typeof that.enforcePosition!=="undefined"){if(that.enforcePosition==="top"){$("#tooltip-icon").addClass("tooltip_corner_sprites top_tooltip");that.tooltip.style.left=(coord.left-(contentWidth/2)+parseInt(coord.width/2)+scrollX)+"px";
that.tooltip.style.top=(coord.bottom+scrollY)+"px";that.currentSetPosition="top";}if(that.enforcePosition==="bottom"){var tooltipContent=$("#tooltip-container")[0].getBoundingClientRect();var contentHeight=parseInt(tooltipContent.bottom-tooltipContent.top);var contentWidth=parseInt(tooltipContent.right-tooltipContent.left);
$("#tooltip-icon").addClass("tooltip_corner_sprites bottom_tooltip");var calc=(coord.left-(contentWidth/2)+parseInt(coord.width/2)+scrollX);var leftVal=calc;if((scrollWidth-calc)<contentWidth){leftVal=(calc-((calc+contentWidth)-scrollWidth+20));that.tooltip.style.left=leftVal+"px";that.tooltip.style.top=(coord.top-contentHeight+scrollY-5)+"px";
$("#tooltip-icon").css("top",(contentHeight-13)+"px");$("#tooltip-icon").css("left",(coord.left-(leftVal-((leftVal+contentWidth)-scrollWidth+20)))+"px");}else{that.tooltip.style.left=calc+"px";that.tooltip.style.top=(coord.top-contentHeight+scrollY-5)+"px";$("#tooltip-icon").css("top",(contentHeight-13)+"px");
$("#tooltip-icon").css("left",(coord.left-leftVal)+"px");}that.currentSetPosition="bottom";}if(that.enforcePosition==="left"){$("#tooltip-icon").addClass("tooltip_corner_sprites left_tooltip");that.tooltip.style.left=(coord.right+5)+"px";if(reorder){$("#tooltip-icon").css("top",(contentHeight-10)+"px");
that.tooltip.style.top=(coord.top+parseInt(coord.height/2)+scrollY-contentHeight)+"px";}else{that.tooltip.style.top=(coord.top-40+parseInt(coord.height/2)+scrollY)+"px";}that.currentSetPosition="left";}if(that.enforcePosition==="right"){$("#tooltip-icon").addClass("tooltip_corner_sprites right_tooltip");
that.tooltip.style.left=(coord.left-contentWidth-20)+"px";if(reorder){$("#tooltip-icon").css("top",(contentHeight-10)+"px");that.tooltip.style.top=(coord.top+parseInt(coord.height/2)+scrollY-contentHeight)+"px";}else{that.tooltip.style.top=(coord.top-40+parseInt(coord.height/2)+scrollY)+"px";}that.currentSetPosition="right";
}}}function showTooltip(){if(that.onTarget){that.lastHoverTimestamp=(new Date()).getTime();$("#tooltip-content").css("width",that.contentWidth+"px");if(that.enforceHeight){$("#tooltip-content").css("height",that.enforceHeight+"px");}that.tooltip.style.width=(that.contentWidth+80)+"px";that.tooltip.style.display="block";
setTooltipPos((that.contentWidth+34));if(!that.contentReady){$("#tooltip-content").html('<div style="text-align:center;height:33px;"><img src="/iv/common/styles/images/LoadingAnimation.gif" hspace="5" align="absmiddle" />'+"<b>Loading...</b></div>");that.fetchContentFromSource(true);}else{setContent();
}that.shown=true;that.keepAlive=true;if(that.displayCallback&&that.contentReady){that.displayCallback();}window.setTimeout(function(){reorderTooltip();},300);}}function hideTooltip(){if(that.shown===true&&that.keepAlive===false){that.tooltip.style.display="none";$("#tooltip-content").html("");that.shown=false;
that.keepAlive=false;var duration=0;if(that.lastHoverTimestamp!=null){duration=(new Date()).getTime()-that.lastHoverTimestamp;duration/=1000;}that.lastHoverDuration=duration;if(that.lastHoverDuration>=that.trackingDuration&&!that.trackingComplete){iv.api.userAction.getContent({urlParams:{"duration":that.lastHoverDuration},resource:that.trackingUrl});
that.trackingComplete=true;}}}function reorderTooltip(){if(that.contentReady){var tooltipContent=$("#tooltip-content")[0].getBoundingClientRect();var contentHeight=tooltipContent.bottom-tooltipContent.top;var coord=getTopAndLeft();if((coord.top+contentHeight)>getWindowHeight()||typeof that.enforcePosition!="undefined"){setTooltipPos((that.contentWidth+34),contentHeight);
}if(tooltipContent.left<0){var scrollX=(typeof window.pageYOffset!="undefined")?window.pageXOffset:document.documentElement.scrollLeft;$("#tooltip-icon").css("left",(coord.left+scrollX+15)+"px");that.tooltip.style.left=(coord.left+scrollX)+"px";}}else{window.setTimeout(reorderTooltip,300);}}function insideTooltip(){that.keepAlive=true;
return false;}function leavingTooltip(){that.keepAlive=false;delayHideTooltip();return false;}function offTarget(){that.onTarget=false;that.keepAlive=false;destroyShowEvent();delayHideTooltip();return false;}function onTarget(){that.onTarget=true;destroyhideEvent();delayShowTooltip();return false;}function delayShowTooltip(){if(!that.shown){that.showEvent=setTimeout(showTooltip,that.delay);
}}function delayHideTooltip(){if(that.shown&&!that.keepAlive){that.hideEvent=setTimeout(hideTooltip,that.delay);}}var setContent=function(){$("#tooltip-content").html(that.content);};this.setTooltipContent=function(){setContent();};var that=this;$(this.target).bind("mouseenter",onTarget);$(this.target).bind("mouseleave",offTarget);
$(this.tooltip).bind("mouseenter",insideTooltip);$(this.tooltip).bind("mouseleave",leavingTooltip);}ivTooltip.prototype.makeItTooltip=function(){this.tooltipTemplate='<div class="inner_tt_container" >'+'<div id="tooltip-icon"></div>'+'<table cellspacing="0" cellpadding="0px">'+"<tbody>"+'<tr style="height: auto;">'+'<td class="tooltipBox_lt tooltip_corner_sprites"></td>'+'<td class="tooltipBox_top tooltip_top_bottom_sprites"></td>'+'<td class="tooltipBox_rt tooltip_corner_sprites"></td>'+"</tr>"+'<tr style="height: auto;">'+'<td class="tooltipBox_left tooltip_left_right_sprites"></td>'+'<td valign="top" style="height: auto; background-color: white;">'+'<div class="company-tt-data" id="tooltip-content">'+'<img src="/iv/common/styles/images/LoadingAnimation.gif" align="absmiddle" hspace="5" vspace="5"/><b>Loading...</b>'+"</div>"+'</td><td class="tooltipBox_right tooltip_left_right_sprites"></td>'+"</tr>"+'<tr style="height: auto;">'+'<td class="tooltipBox_lb tooltip_corner_sprites"></td>'+'<td class="tooltipBox_bottom tooltip_top_bottom_sprites"></td>'+'<td class="tooltipBox_rb tooltip_corner_sprites" style=""></td>'+"</tr></tbody>"+"</table>"+"</div>";
this.tooltip.innerHTML=this.tooltipTemplate;};ivTooltip.prototype.getTooltipContainer=function(){if(!$("#tooltip-container")[0]){var t=document.createElement("div");t.id="tooltip-container";t.className="tooltip_container";document.body.appendChild(t);return t;}else{return $("#tooltip-container")[0];}};
ivTooltip.prototype.refreshContent=function(){this.fetchContentFromSource();};ivTooltip.prototype.setPosition=function(){};ivTooltip.prototype.contentFail=function(){this.content="Unable to fetch content";this.contentReady=true;};ivTooltip.prototype.fetchContentFromSource=function(fetchAndSet){var that=this;
this.fetchInProgress=true;var getter=(typeof this.dataType!="undefined"&&this.dataType=="json")?iv.api.getJson:iv.api.getContent;getter({success:function(content){if(typeof that.template!="undefined"&&that.template!=""){that.content=_.template(that.template,content);}else{that.content=content;}that.contentReady=true;
that.fetchInProgress=false;if(fetchAndSet&&that.onTarget){that.setTooltipContent();if(that.displayCallback){that.displayCallback();}}},error:function(){that.fetchInProgress=false;that.contentFail();},resource:this.dataSource,method:"GET"});};