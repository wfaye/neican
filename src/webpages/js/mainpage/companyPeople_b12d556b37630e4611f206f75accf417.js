iv.follow.manager={processItems:function(list){var $this=this;_.each(list,function(item){$this.createFollowWidgetItem(item.selector,item.config);});},createWidgets:function(list){this.processItems(list);iv.initMenus();},createFollowWidgetItem:function(selector,config){$(selector).setupFollow(config);
}};(function($){var ivFollow=function(elem,options){this.followContainer=elem;this.clickedElem=null;this.isActionActive=false;this.uid=options.uid;this.followId=options.followId;this.config={entityType:"company",followType:"inline",trackedByWatchlists:[],urls:{"follow":"/iv/followEntityInWatchlist.iv","unfollow":"/iv/unfollowEntityFromWatchlist.iv"},menuHeaderTemplate:'<div id="add_<~%=current%~>"> <ul class="menu follow-menu '+"<~% if(trackedByWatchlists.length != 0) { %~>"+"following-type-<~%=followType%~> "+"<~% } else { %~>"+"follow-type-<~%=followType%~> "+"<~% } %~>"+' ieOverride" id="wlAddMenu_<~%=uid%~>">'+"<li>"+"<~% if(trackedByWatchlists.length != 0) { %~>"+'<a class="<~% if(followType == "inline"){%~> hover-button<~% } %~>" href="javascript:void(0);">'+'<div title="Add <~%=entityType%~> to your InsideView Watchlist" class="following-<~%=followType%~>-<~%=entityType%~>">'+'<div class="new-follow-sprite followingSymbol"></div>'+'<span class="textHook float_left">Following</span>'+'<span class="new-follow-sprite track-arw-<~%=followType%~>"></span> '+"<~% } else { %~>"+' <a class="<~% if(followType == "inline"){%~> hover-button<~% } %~>" href="javascript:void(0);">'+'<div title="Add <~%=entityType%~> to your InsideView Watchlist" class="follow-<~%=followType%~>-<~%=entityType%~>">'+'<div class="new-follow-sprite followSymbol"></div>'+'<span class="textHook float_left">Follow</span> '+'<span class="new-follow-sprite float_left track-arw-<~%=followType%~>"></span> '+"<~% } %~>"+"</div>"+'<div style="clear: both; height: 0px; width: 0px;"></div></a>',menuBodyTemplate:"<ul>"+"<~%_.each(watchlistInfo , function(wlObj){%~>"+'<li style="clear:both;">'+'<~% if(wlObj["type"] == 2) { %~>'+'<~% if($.inArray(wlObj["id"],trackedByWatchlists) > -1 || $.inArray(wlObj["id"],trackedByWatchlists) != -1) { %~>'+'<a class="following-<~%=entityType%~>-freq following-entity freq-viewed-wl" id="<~%=wlObj["id"]%~>" rel="<~%=wlObj["id"]%~>"><img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle" style="visibility:visible"/>&nbsp;'+'<span><~%=wlObj["name"]%~></span></a>'+"<~%}else{%~>"+'<span class="dynamic follow" title="Frequently Viewed Watchlist - cannot add '+" <~% entityType == \"company\" ? 'companies' : 'people'; %~>"+' manually."><img width="16" height="16" align="absmiddle" style="visibility:hidden;padding-right:5px;" src="/iv/common/styles/images/checked2.png">Frequently Viewed</span>'+"<~%}%~>"+'<~%}else if(wlObj["type"] == 0){%~>'+'<~% if($.inArray(wlObj["id"],trackedByWatchlists) > -1 || $.inArray(wlObj["id"],trackedByWatchlists) != -1) { %~>'+'<a rel="<~%=wlObj["id"]%~>" href="javascript:void(0);" class="following-entity">'+'<img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle"/>&nbsp;'+"<~%}else{%~>"+'<a rel="<~%=wlObj["id"]%~>" href="javascript:void(0);" class="follow-entity">'+'<img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle" style="visibility:hidden"/>&nbsp;'+"<~%}%~>"+'<~% if(wlObj["name"].length > 17){ wlObj["name"] = wlObj["name"].substring(0,14) + "..."; %~>'+"<~%}%~>"+'<span><~%=wlObj["name"]%~></span></a>'+'<~%}else if(wlObj["type"] == 1){%~>'+'<span class="dynamic follow" title="Automated Watchlist - cannot add '+"<~% entityType == \"company\" ? 'companies' : 'people'; %~> manually.\">"+'<img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle" '+'<~% if($.inArray(wlObj["id"],trackedByWatchlists) == -1) { %~>'+'style="visibility:hidden"'+"<~%}%~>  />&nbsp;"+'<img align="absmiddle" src="/iv/common/styles/images/salesforce_logo.png" style="width:16px;height:16px;padding-right:5px;"/>'+'<~% if(wlObj["name"].length > 17){ wlObj["name"] = wlObj["name"].substring(0,14) + "..."; %~>'+"<~%}%~>"+'<~%=wlObj["name"]%~></span></li>'+"<~%}});%~>"+"<~% if(dynamicCreateWL != false) { %~>"+'<li class="createAutomatedWL">'+'<~% if(dynamicCreateWL == "enabled") { %~>'+'<a href="/iv/watchlist.iv?dynamicWatchlistEnabled=true&newSFDCWatchList=true" target="insideview">'+"<span>Create Automated Watchlist</span></a>"+"<~%} else {%~>"+'<span class="dynamic">Create Automated Watchlist</span>'+"<~%}%~>"+"</li>"+"<~%}%~>"+"</ul></li></ul></div>"};
if(typeof options!="undefined"){$.extend(true,this.config,options);}if(this.config.entityType=="company"){this.entityParams={type:"company",companyId:this.config.companyId};this.config.currentId=this.config.companyId;}else{if(this.config.entityType=="person"){this.entityParams={type:"person",employmentId:this.config.employmentId,executiveId:this.config.executiveId};
this.config.currentId=this.config.executiveId;}}this.showFollowMenu();this.attachDelegates();};ivFollow.prototype.showFollowMenu=function(){var html="";var d=new Date();var dynamicCreateWL=false;if(iv.user.data.dynamicWLEnabled!="false"&&iv.isMashup){if(_.size(iv.user.data.genericWatchlistInfo)<iv.user.data.maxWLSize){dynamicCreateWL="enabled";
}else{dynamicCreateWL="disabled";}}var trackedByWatchlists=[];_.each(this.config.trackedByWatchlists,function(watchlistId){if(watchlistId!=""){trackedByWatchlists.push(parseInt(watchlistId));}});this.config.trackedByWatchlists=trackedByWatchlists;html+=_.template(this.config.menuHeaderTemplate,{trackedByWatchlists:this.config.trackedByWatchlists,followType:this.config.followType,current:this.config.currentId,entityType:this.config.entityType,uid:this.uid});
var html2=_.template(this.config.menuBodyTemplate,{trackedByWatchlists:this.config.trackedByWatchlists,watchlistInfo:this.config.watchlistInfo,followType:this.config.followType,current:this.config.currentId,entityType:this.config.entityType,dynamicCreateWL:dynamicCreateWL});this.followContainer.html(html+html2);
};ivFollow.prototype.attachDelegates=function(){var $this=this;if($("body").hasClass("follow-entity-init")){return;}$("body").delegate("a","click",function(){var target=$(this);if(!target.hasClass("follow-entity")&&!target.hasClass("following-entity")){return;}var targEntity=iv.user.followMetaData[target.parents(".follow-menu").attr("id").split("_")[1]];
if(target.hasClass("follow-entity")&&!targEntity.isActionActive){targEntity.isActionActive=true;target.css("opacity","0.5");var wId=target.attr("rel");targEntity.clickedElem=target.find("span");target.removeClass("follow-entity").addClass("following-entity");$.extend(targEntity.entityParams,{watchlistId:wId});
targEntity.followAction("follow");}else{if(target.hasClass("following-entity")&&!targEntity.isActionActive){targEntity.isActionActive=true;target.css("opacity","0.5");var wId=target.attr("rel");targEntity.clickedElem=target.find("span");$.extend(targEntity.entityParams,{watchlistId:wId});if(target.hasClass("following-"+targEntity.config.entityType+"-freq")){target.removeClass("following-"+$this.config.entityType+"-freq").css("opacity","0.5");
target.css("cursor","normal");target.removeClass("following-entity");}else{target.removeClass("following-entity").addClass("follow-entity");}targEntity.followAction("unfollow");}}});$("body").addClass("follow-entity-init");};ivFollow.prototype.actionCallback=function(resp){this.isActionActive=false;if(resp.error==false){iv.hub.publishEvent("REFRESH_SETUP","followCompanies");
var menuId="wlAddMenu_"+this.uid;var spanText=$("#"+menuId).find(".textHook");if($(this.clickedElem).parent("a").find("img").css("visibility")=="hidden"){$(this.clickedElem).parent("a").find("img").css("visibility","visible");$(this.clickedElem).parent("a").css("opacity","1");this.config.trackedByWatchlists.splice(0,0,this.entityParams.watchlistId);
var watchlistId=$(this.clickedElem).parent("a").attr("rel");if(this.config.entityType=="company"){iv.user.data.genericWatchlistInfo[watchlistId]["companies"].push(this.followId);}else{iv.user.data.genericWatchlistInfo[watchlistId]["executives"].push(this.followId);}if(spanText.text()=="Follow"){$("#"+menuId).removeClass("follow-type-"+this.config.followType).addClass("following-type-"+this.config.followType);
spanText.text("Following");$("#"+menuId).find("div.new-follow-sprite").removeClass("followSymbol").addClass("followingSymbol");spanText.parent("div").removeClass("follow-"+this.config.followType+"-"+this.config.entityType).addClass("following-"+this.config.followType+"-"+this.config.entityType);}}else{$(this.clickedElem).parent("a").find("img").css("visibility","hidden");
if($(this.clickedElem).parent("a").hasClass("freq-viewed-wl")){$(this.clickedElem).parent("a").css("opacity","0.5");}else{$(this.clickedElem).parent("a").css("opacity","1");}var index=$.inArray(this.entityParams.watchlistId,this.config.trackedByWatchlists);this.config.trackedByWatchlists.splice(index,1);
var watchlistId=$(this.clickedElem).parent("a").attr("rel");if(this.config.entityType=="company"){iv.user.data.genericWatchlistInfo[watchlistId]["companies"]=_.without(iv.user.data.genericWatchlistInfo[watchlistId]["companies"],this.followId);}else{iv.user.data.genericWatchlistInfo[watchlistId]["executives"]=_.without(iv.user.data.genericWatchlistInfo[watchlistId]["executives"],this.followId);
}if(spanText.text()=="Following"&&this.config.trackedByWatchlists.length==0){$("#"+menuId).removeClass("following-type-"+this.config.followType).addClass("follow-type-"+this.config.followType);spanText.text("Follow");$("#"+menuId).find("div.new-follow-sprite").removeClass("followingSymbol").addClass("followSymbol");
spanText.parent("div").removeClass("following-"+this.config.followType+"-"+this.config.entityType).addClass("follow-"+this.config.followType+"-"+this.config.entityType);}}}else{if(resp.error==true){this.isActionActive=false;if($(this.clickedElem).parent("a").hasClass("following-entity")){$(this.clickedElem).parent("a").removeClass("following-entity").addClass("follow-entity");
}else{$(this.clickedElem).parent("a").removeClass("follow-entity").addClass("following-entity");}$(this.clickedElem).parent("a").css("opacity","1");if(resp.errorType="WatchlistLimitError"){iv.stopPoint.show("addRecordsToWatchlist");}}}};ivFollow.prototype.followAction=function(followtype){var $this=this;
iv.api.userAction.getJson({resource:this.config.urls[followtype],urlParams:this.entityParams,success:function(resp){$this.actionCallback(resp);},error:function(resp){$this.actionCallback(resp);}});};$.fn.setupFollow=function(options){var ts=iv.util.getUniqueId();if(typeof options.companyId!=="undefined"){var uid=options.companyId+ts;
var followId=options.companyId;}else{var uid=options.executiveId+options.employmentId+ts;var followId=options.executiveId;}options["uid"]=uid;options["followId"]=followId;registerNS("iv.user.followMetaData");iv.user.followMetaData[uid]=new ivFollow(this,options);return iv.user.followMetaData[uid];};})(jQuery);
(function($){$.fn.roundBox=function(options){return this.each(function(){var $this=$(this);if(typeof options!=="undefined"&&typeof options.width!=="undefined"&&typeof options.content!=="undefined"){var html="";html+='<div class="round-container">';html+='	<div class="round-top-right">';html+='		<div class="round-top-left">';
html+='			<div class="round-top-center"></div>';html+="		</div>";html+="   </div>";html+='	<div class="round-container-content">';html+=options.content;html+="   </div>";html+='   <div class="round-bottom-right">';html+='		<div class="round-bottom-left">';html+='			<div class="round-bottom-center"></div>';
html+="		</div>";html+="   </div>";html+="</div>";$this.append(html);$this.find(".round-container").css({width:options.width,"background-color":"#F3F3F3"});$this.find(".round-top-right").css({background:"url(/iv/common/styles/images/grey-top-right.gif) no-repeat 100% 90%",height:"8px"});$this.find(".round-top-left").css({background:"url(/iv/common/styles/images/grey-top-left.gif) no-repeat 0% 90%",height:"8px"});
$this.find(".round-top-center").css({"border-top":"1px solid #CCC",margin:"0 10px"});$this.find(".round-bottom-right").css({background:"url(/iv/common/styles/images/grey-bottom-right.gif) no-repeat top right",height:"9px"});$this.find(".round-bottom-left").css({background:"url(/iv/common/styles/images/grey-bottom-left.gif) no-repeat -1px 0px",height:"9px"});
$this.find(".round-bottom-center").css({"border-bottom":"1px solid #CCC",margin:"0px 10px 0px 9px","padding-top":"8px"});$this.find(".round-container-content").css({"border-left":"1px solid #CCC","border-right":"1px solid #CCC",padding:"0px 10px","margin-right":"1px"});}});};})(jQuery);registerNS("iv.genProf");
iv.genProf={data:null,location:"contactSearch",createGenerateBox:function(){$("#generate-profile-links").roundBox({width:"100%",content:$("#generate-profile-links-template").html()});$("#generate-profile-links-template").empty();$(".show-gen-profile-form").bind("click",function(e){iv.genProf.showGenerateProfileForm(e);
iv.util.logUserActivity("Contacts-Generate-Profile-Show");e.stopPropagation();return false;});if(this.isPeopleTab()){}},showGenerateProfileLink:function(){$("#generate-profile-links").show();if($(".generate-box").width()<700){$(".generate-box .gen-prof-main-left").css("width","400px");}$("#search-for-more-box").css("padding-top",0);
},hideGenerateProfileLink:function(){$("#generate-profile-links").hide();},init:function(data){this.data=data;if(data.type==="peopleTab"){this.location=data.type;this.peopleTab=true;}else{if(data.type==="contactSearch"){this.location=data.type;this.contactSearch=true;this.processForContactSearch();}}this.formCreated=false;
this.createGenerateBox();iv.genProf.preview.init(this.data);},peopleTab:false,contactSearch:false,isPeopleTab:function(){return this.peopleTab;},isContactSearch:function(){return this.contactSearch;},processForContactSearch:function(){this.fetchCorpAddress();},corpAddress:null,saveCorpAddress:function(resp){this.corpAddress=resp.data;
},corpAddressFail:function(data){this.corpAddress=null;},fetchCorpAddress:function(){iv.api.getJson({resource:"/iv/generateExecProfile.do",urlParams:{call:"getCorpAddress",crm_account_id:this.data.crm_account_id,crm_account_name:this.data.crm_account_name},success:function(data){iv.genProf.saveCorpAddress(data);
},error:function(){iv.genProf.corpAddressFail();}});},staticValidationMessage:"One or more required fields are empty.",areRequireFieldsFilled:function(){if(this.isContactSearch()){if($("#gen-prof-contact-name").val()===""||$("#gen-prof-contact-name").val()===this.fieldList["gen-prof-contact-name"].prompt||$("#gen-prof-contact-title").val()===""||$("#gen-prof-contact-title").val()===this.fieldList["gen-prof-contact-title"].prompt||$("#gen-prof-contact-company").val()===""||$("#gen-prof-comp-url").val()===""){alert(this.staticValidationMessage);
return false;}else{return true;}}if(this.isPeopleTab()){if($("#gen-prof-contact-name").val()===""||$("#gen-prof-contact-name").val()===this.fieldList["gen-prof-contact-name"].prompt||$("#gen-prof-contact-title").val()===""||$("#gen-prof-contact-title").val()===this.fieldList["gen-prof-contact-title"].prompt||$("#gen-prof-contact-company").val()===""){alert(this.staticValidationMessage);
return false;}else{return true;}}},createProfile:function(){if(!this.areRequireFieldsFilled()){return false;}var emailVal=($("#gen-prof-contact-email").val()==this.fieldList["gen-prof-contact-email"].prompt)?"":$("#gen-prof-contact-email").val();var urlVal=($("#gen-prof-comp-url").val()==this.fieldList["gen-prof-contact-email"].prompt)?"":$("#gen-prof-comp-url").val();
if(this.isPeopleTab()){this.showLoader();var fromValue="peopleTab";iv.api.userAction.getJson({resource:"/iv/generateExecProfile.do",urlParams:{call:"createExecutive",name:$("#gen-prof-contact-name").val(),title:$("#gen-prof-contact-title").val(),email:emailVal,companyName:$("#gen-prof-contact-company").val(),companyId:this.data.companyId,from:fromValue},success:function(data){iv.analytics.trackPageView("/iv/generateContactProfileThroughPeopleTab.html");
setTimeout(function(){iv.genProf.generateProfileCallback(data);},100);},error:function(data){if(typeof data==="undefined"){iv.genProf.generateProfileErrorCallback();}else{if(typeof data.errorMessage==="string"){iv.genProf.generateProfileErrorCallback(data.errorMessage);}else{iv.genProf.generateProfileErrorCallback();
}}}});iv.analytics.trackPageView("/iv/submitGenerateProfileData.do");return;}if(this.isContactSearch()){this.showLoader();var fromValue="contactSearch";iv.api.userAction.getJson({resource:"/iv/generateExecProfile.do",urlParams:{call:"getCompanyMatches",name:$("#gen-prof-contact-name").val(),title:$("#gen-prof-contact-title").val(),email:emailVal,companyName:$("#gen-prof-contact-company").val(),street:$("#gen-prof-comp-add").val(),city:$("#gen-prof-comp-city").val(),state:$("#gen-prof-comp-state").val(),zip:$("#gen-prof-comp-zip").val(),country:$("#gen-prof-comp-country").val(),website:urlVal,from:fromValue},success:function(data){iv.genProf.generateProfileCallback(data);
},error:function(data){if(typeof data==="undefined"){iv.genProf.generateProfileErrorCallback();}else{if(typeof data.errorMessage==="string"){iv.genProf.generateProfileErrorCallback(data.errorMessage);}else{iv.genProf.generateProfileErrorCallback();}}}});return;}},generateProfileErrorCallback:function(msg){if(typeof msg!=="undefined"){alert(msg);
}else{alert(this.staticGenProfErrorMsg);}this.hideLoader();},staticGenProfErrorMsg:"Unable to Generate Profile. Please try again later.",generateProfileCallback:function(resp){if(resp.error){this.hideLoader();this.generateProfileErrorCallback(resp.errorMessage);}else{if(resp.data.matched){if(this.isPeopleTab()){this.handleGenerateInPeopleTab(resp);
}if(this.isContactSearch()){this.handleGenerateInContactSearch(resp);}}else{if(this.isContactSearch()){this.hideLoader();this.showCompanyMatches(resp);this.companyMatches=resp.data.matches;this.renderCompanyMatchesResults(resp.data.matches);}}}},getCompanyNameFromId:function(id){var comp=_.detect(this.companyMatches,function(obj){return obj.companyId===id;
});return comp.companyName;},companyMatches:[],handleGenerateInContactSearch:function(resp){if(resp.data.matched){var $this=this;if(resp.data.isCurrent==false&&!this.data.crm_size){this.addContactModal=new modal();$("#gen-prof-hide-container").hide();this.addContactModal.initModalDialog({metrics:{width:400},content:'<div id="inactive_info" style="height:200px"><br/><br/><br/><center><img src="/iv/common/styles/images/LoadingAnimation.gif" alt="Loading"> Loading...</center></div>',controlsEnabled:true,moveControlEnabled:false,callback:function(){$this.handleAddContactModal(resp);
},disableOverlay:false});this.addContactModal.displayModal();$(".modal_close").bind("click",function(){this.addContactModal.hideModal();$this.redirectToEmployment(resp.data.employmentId);});}else{this.redirectToEmployment(resp.data.employmentId);}}else{this.generateProfileErrorCallback(this.staticGenProfErrorMsg);
}},handleGenerateInPeopleTab:function(resp){if(resp.data.matched){var $this=this;if(this.data.inMashup){$this.hideLoader();if(resp.data.isCurrent===true||this.data.crm_size){$("#keywordSearch").val(resp.data.executiveName);this.hideGenerateProfileFormAndRestoreElements();company.people.filter.simulateArtificialFilter();
}if(!this.data.crm_size&&resp.data.isCurrent==false){this.addContactModal=new modal();this.addContactModal.initModalDialog({metrics:{width:400},content:'<div id="inactive_info" style="height:200px"><br/><br/><br/><center><img src="/iv/common/styles/images/LoadingAnimation.gif" alt="Loading"> Loading...</center></div>',controlsEnabled:true,moveControlEnabled:false,callback:function(){$this.handleAddContactModal(resp);
},disableOverlay:false});this.addContactModal.displayModal();$(".modal_close").bind("click",function(){this.addContactModal.hideModal();$this.redirectToEmployment(resp.data.employmentId);});}return false;}else{this.redirectToEmployment(resp.data.employmentId);}}else{this.generateProfileErrorCallback(this.staticGenProfErrorMsg);
}},handleAddContactModal:function(resp){iv.api.getHtmlContent({target:$("#inactive_info"),success:function(){},resource:"/iv/hoverView.iv?callFunction=showEmployment&empId="+resp.data.employmentId});},redirectToEmployment:function(employmentId){if(this.isPeopleTab()){window.location.href="/iv/executiveinfo.do?methodToCall=overview&id="+employmentId;
}if(this.isContactSearch()){iv.execMatcher.doMatchExecutive(employmentId);}},hideLoader:function(){if(this.isPeopleTab()){$("#generate-profile-form").css("position","static");$("#genProfHideForm").hide();if(this.data.inMashup){$("#people-main-box").css({"position":""});}}if(this.isContactSearch()){$("#gen-prof-hide-container").hide();
$("#content_data_table").css({"position":""});}},showLoader:function(){if(this.isContactSearch()){$("#gen-prof-hide-container").show();$("#content_data_table").css({"position":"relative"});}if(this.isPeopleTab()){$("#generate-profile-form").css("position","relative");$("#genProfHideForm").show();if(this.data.inMashup){$("#people-main-box").css({"position":"relative"});
}}},mapExecutiveToCompanyAndCreate:function(companyId){this.showLoader();var fromValue="";if(this.isContactSearch()){fromValue="contactSearch";}else{if(this.isPeopleTab()){fromValue="peopleTab";}}iv.api.userAction.getJson({resource:"/iv/generateExecProfile.do",urlParams:{call:"createExecutive",name:$("#gen-prof-contact-name").val(),title:$("#gen-prof-contact-title").val(),email:$("#gen-prof-contact-email").val(),companyId:companyId,companyName:this.getCompanyNameFromId(companyId),from:fromValue},success:function(data){iv.genProf.generateProfileCallback(data);
},error:function(){iv.genProf.generateProfileErrorCallback();}});return false;},showCompanyMatches:function(){this.displayCompanyMatchesView();$("#gen-prof-looking-for-comp").html($("#gen-prof-contact-company").val());},displayCompanyMatchesView:function(){$("#generate-profile-form").hide();$("#generate-profile-company-matches").show();
},backToGenProfileForm:function(){$("#generate-profile-form").show();$("#generate-profile-company-matches").hide();},companyMatchHeader:' <div class="rows-header"><div class="fillerLeft"><div class="filler-left-image"></div></div>'+'<div class="data dataCol22">'+'<span class="header-text">'+"  Name"+"</span>"+"</div>"+'<div class="data dataCol20">'+'<span class="header-text">'+"  Type"+" </span>"+"</div>"+'<div class="data dataCol20">'+' <span class="header-text">'+"   Location"+" </span>"+" </div>"+'<div class="data dataCol16right">'+'<span class="header-text">'+"  Revenue"+" </span>"+"</div>"+' <div class="data dataCol18right">'+'<span class="header-text">'+" Employees"+"</span>"+"</div>"+'<div class="fillerRight"><div class="filler-right-image"></div></div>'+" </div>",companyMatchTemplate:'<~%_.each(matches,function(obj){var showCountryComma = false;%~><div class="rows"><div class="fillerLeft"></div>'+'<div class="data dataCol22" style="float: left;">'+"<span >"+'<a class="bluefont" href="#" onclick="iv.genProf.mapExecutiveToCompanyAndCreate(\'<~%=obj.companyId%~>\');">'+"<~%=obj.companyName%~></a>"+'<~%if(obj.website!==""){%~><br><~%=obj.website%~><~%}%~>'+"</span>&nbsp;</div>"+'<div class="data dataCol20" style="float: left;">'+"<~%=obj.type%~>"+'<~%if(obj.ticker!==""){%~>(<~%=obj.ticker%~>)<~%}%~>'+"</div>"+'<div class="data dataCol20" style="float: left;">'+'<span class="title" >'+'<~%if(obj.location.city==="" && obj.location.state==="" && obj.location.country===""){%~>'+"NA<~%}%~>"+"<~%if(!_.isUndefined(obj.location.city)){"+'if(obj.location.city!==""){%~>'+"<~%=obj.location.city%~>"+"<~%showCountryComma=true;}}%~>"+"<~%if(!_.isUndefined(obj.location.state)){"+'if(obj.location.state!==""){%~>,<~%=obj.location.state%~>'+"<~%showCountryComma=true;}}%~>"+"<~%if(!_.isUndefined(obj.location.country)){"+'if(obj.location.country!==""){%~><~%if(showCountryComma){%~>,<~%}%~><~%=obj.location.country%~>'+"<~%}}%~>"+"</span>"+"</div>"+'<div class="data dataCol16right" style="float: left;">'+"<~%=obj.revenue%~>"+"</div>"+'<div class="data dataCol18right" style="float: left;">'+"<~%=obj.employees%~>"+"</div>"+'<div class="fillerRight">'+"</div>"+"</div>"+"<~% });%~>",noResultsFound:'<div class="rows"><div class="fillerLeft"></div>'+'<div class="data" style="width: 98%; float: left;"><span class="title" >No Company Matches Found.</span></div>'+'<div class="fillerRight"></div>'+"</div>",renderCompanyMatchesResults:function(data){var matchRows=this.noResultsFound;
if(data.length>0){var matchRows=_.template(this.companyMatchTemplate,{matches:data});}var matchHtml=this.companyMatchHeader+matchRows;$("#company-match-result-count").html(data.length+" Results");$("#gen-prof-comp-matches").html(matchHtml);},formCreated:false,fieldList:{"gen-prof-contact-name":{selector:"#gen-prof-contact-name",prompt:""},"gen-prof-contact-title":{selector:"#gen-prof-contact-title",prompt:""},"gen-prof-contact-email":{selector:"#gen-prof-contact-email",prompt:""},"gen-prof-comp-url":{selector:"#gen-prof-comp-url",prompt:""}},setFieldHelpText:function(){_.each(this.fieldList,function(obj){var targ=$(obj.selector);
targ.focus(function(){if(targ.val()===obj.prompt){targ.val("");targ.css({"color":"#333"});}});targ.blur(function(){if(targ.val()===""){targ.val(obj.prompt);targ.css({"color":"#333"});}});targ.blur();});},createGenerateProfileForm:function(){$("#generate-profile-form").html($("#generate-profile-form-template").html());
$("#generate-profile-form-template").empty();$("#back-to-results").bind("click",function(){iv.genProf.hideGenerateProfileFormAndRestoreElements();iv.util.logUserActivity("Contacts-Generate-Profile-Hide");return false;});$("#create-new-profile").bind("click",function(){if($(this).css("opacity")>0.5){iv.genProf.createProfile();
}return false;});this.setFieldHelpText();$(".gen-profile-box input").keyup(function(e){var requiredElements=$(".gen-profile-box input:visible").filter(function(){return $(this).parent().prev().find(".gen_prof_text_red").length>0;});$("#create-new-profile").css("opacity","1");for(var i=0;i<requiredElements.length;
i++){if(jQuery.trim($(requiredElements[i]).val())==""){$("#create-new-profile").css("opacity","0.5");}}if(e.keyCode===13){iv.genProf.createProfile();e.stopPropagation();return false;}});$(".gen-profile-box input").bind("focus",function(){var elem=$(this);var timerID=window.setInterval(function(){var requiredElements=$(".gen-profile-box input:visible").filter(function(){return $(this).parent().prev().find(".gen_prof_text_red").length>0;
});$("#create-new-profile").css("opacity","1");for(var i=0;i<requiredElements.length;i++){if(jQuery.trim($(requiredElements[i]).val())==""){$("#create-new-profile").css("opacity","0.5");break;}}},100);elem.data("timerID",timerID);}).bind("blur",function(){var elem=$(this);var timerID=elem.data("timerID");
window.clearInterval(timerID);});$("form[name=crmExecutiveMatchForm]").bind("keypress",function(e){if(e.keyCode==13&&$(e.originalTarget).parents().is(".gen-profile-box")){return false;}});if(this.isPeopleTab()){$("#gen-prof-company-info-part").hide();$("#company-row-gen-prof").hide();$("#companyurlrow").hide();
}$("#gen-prof-contact-name").bind("change",function(){iv.genProf.preview.config.name=$(this).val();iv.genProf.preview.search();});$("#gen-prof-contact-title").bind("change",function(){iv.genProf.preview.config.title=$(this).val();iv.genProf.preview.search();});$("#gen-prof-contact-company").bind("change",function(){iv.genProf.preview.config.company=$(this).val();
iv.genProf.preview.search();});},hideGenerateProfileFormAndRestoreElements:function(){if(this.isPeopleTab()){$("#generate-profile-form").hide();$("#peopleTabContent").slideDown("slow",function(){$("#generate-profile-links").show();});$("#doFilterContainer").parents(".grey_container").show();iv.analytics.trackPageView("/iv/backToFitlerResults.do");
}if(this.isContactSearch()){$("#generate-profile-form").hide();$("#generate-profile-links").show();$("#box_cutout").slideDown("slow");}$("#search-for-more-box").css("padding-top","4px");},filterStringText:"Name and / or Title",populateForm:function(){if(this.isPeopleTab()){var filterString=$("#keywordSearch").val();
if(this.filterStringText!==filterString){$("#gen-prof-contact-name").val(filterString);$("#search-string-gen-profile").html(" for "+filterString);}else{filterString="";}$("#gen-prof-company-name").html(this.data.companyName);$("#gen-prof-contact-company").val(this.data.companyName);}if(this.isContactSearch()){$("#search-string-gen-profile").html(" for "+$('input[name="execFullName"]').val());
$("#gen-prof-contact-name").val($('input[name="execFullName"]').val());$("#gen-prof-company-name").html($('input[name="crm_account_name"]').val());$("#gen-prof-contact-company").val($('input[name="contact_company_name"]').val());$("#gen-prof-contact-title").val(this.data.crm_title);$("#gen-prof-contact-email").val(this.data.crm_email);
if(typeof execMatcherData.contactCompanyData!="undefined"&&execMatcherData.contactCompanyData.length!=0){var data=execMatcherData.contactCompanyData;if(typeof data[0].name!="undefined"){$("#gen-prof-contact-company").val(iv.util.decodeHTML(execMatcherData.contactCompanyData[0].name));}$("#gen-prof-contact-title").val(iv.util.decodeHTML($.trim($("#results-inside-view .rows:first div").eq(2).html())));
}this.populateCorpAddress();}var name=jQuery.trim($("#gen-prof-contact-name").val());var title=jQuery.trim($("#gen-prof-contact-title").val());if(name==""||title==""){$("#create-new-profile").css("opacity","0.5");}},populateCorpAddress:function(){if(typeof this.corpAddress.street!=="undefined"){$("#gen-prof-comp-add").val(this.corpAddress.street);
}if(typeof this.corpAddress.city!=="undefined"){$("#gen-prof-comp-city").val(this.corpAddress.city);}if(typeof this.corpAddress.state!=="undefined"){$("#gen-prof-comp-state").val(this.corpAddress.state);}if(typeof this.corpAddress.zip!=="undefined"){$("#gen-prof-comp-zip").val(this.corpAddress.zip);}var countries='<option value="" selected>Choose a country</option>'+"<~% _.each(countries, function(country) { %~>"+'<option value="<~%=country.value%~>"><~%=country.label%~></option>'+"<~% }); %~>";
$("#gen-prof-comp-country").html(_.template(countries,{countries:this.data.countries}));if(typeof this.corpAddress.country!=="undefined"){$("#gen-prof-comp-country").val(this.corpAddress.country);}if(typeof this.corpAddress.website!=="undefined"){$("#gen-prof-comp-url").val(this.corpAddress.website);
if(jQuery.trim(this.corpAddress.website)==""){$("#create-new-profile").css("opacity","0.5");}}},showGenerateProfileForm:function(e){$(".connectionContainer").hide();$("#generate-profile-links").hide();if(this.isContactSearch()){$("#box_cutout").slideUp("slow");$(".white_mid_content").scrollTop(0);}if(this.isPeopleTab()){$("#peopleTabContent").slideUp("slow");
iv.analytics.trackPageView("/iv/genProfileForm.html");}$("#generate-profile-form").show();if(!this.formCreated){this.createGenerateProfileForm();this.formCreated=true;}this.populateForm();this.preview.search();if(this.isContactSearch()){this.createResultView();}},matchViewFlag:false,createResultView:function(){if(this.matchViewFlag){return;
}$("#generate-profile-company-matches").html($("#generate-profile-company-matches-template").html());$("#generate-profile-company-matches-template").empty();$("#gen-prof-back-to-form").bind("click",function(){iv.genProf.backToGenProfileForm();return false;});$(".gen-comp-cont-anyway").bind("click",function(){iv.genProf.generateContactAndCompany();
return false;});this.matchViewFlag=true;},generateContactAndCompany:function(){this.showLoader();var fromValue="";if(this.isContactSearch()){fromValue="contactSearch";}else{if(this.isPeopleTab()){fromValue="peopleTab";}}iv.api.userAction.getJson({resource:"/iv/generateExecProfile.do",urlParams:{call:"createExecutiveAndCompany",name:$("#gen-prof-contact-name").val(),title:$("#gen-prof-contact-title").val(),email:$("#gen-prof-contact-email").val(),companyId:"",companyName:$("#gen-prof-contact-company").val(),street:$("#gen-prof-comp-add").val(),city:$("#gen-prof-comp-city").val(),state:$("#gen-prof-comp-state").val(),zip:$("#gen-prof-comp-zip").val(),country:$("#gen-prof-comp-country").val(),website:$("#gen-prof-comp-url").val(),from:fromValue},success:function(data){iv.genProf.generateProfileCallback(data);
},error:function(){iv.genProf.generateProfileErrorCallback();}});}};registerNS("iv.genProf.preview");iv.genProf.preview={url:"",config:{inMashup:false,name:"",company:"",title:""},search_criteria:"",dummyData:[{"date":"","description":"Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh","url":"http://yogeshtech.com/Aboutus.aspx","title":"<b>Yogesh</b> Tech &gt; Home","clickurl":"http://yogeshtech.com/Aboutus.aspx","dispurl":"<b>yogesh</b>tech.com"},{"date":"","description":"Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh","url":"http://www.readwriteweb.com/enterprise/2011/06/fatwires-yogesh-gupta-on-becom.php","title":"Fatwire's <b>Yogesh</b> Gupta on Becoming Part of <b>Oracle</b>","clickurl":"http://www.readwriteweb.com/enterprise/2011/06/fatwires-yogesh-gupta-on-becom.php","dispurl":"www.readwriteweb.com/enterprise/2011/06/fatwires-<b>yogesh</b>..."},{"date":"","description":"Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh","url":"http://www.oracle.com/us/corporate/acquisitions/fatwire/index.html","title":"<b>Oracle</b> and FatWire","clickurl":"http://www.oracle.com/us/corporate/acquisitions/fatwire/index.html","dispurl":"www.<b>oracle</b>.com/us/corporate/acquisitions/fatwire/index.html"},{"date":"","description":"Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh Yogesh","url":"http://www.linkedin.com/in/yogeshshiralkar","title":"<b>Yogesh</b> Shiralkar, PMP | LinkedIn","clickurl":"http://www.linkedin.com/in/yogeshshiralkar","dispurl":"www.linkedin.com/in/<b>yogesh</b>shiralkar"}],init:function(data){$.extend(this.config,data,true);
},attachEvents:function(){if($(".yahooMoreLess").length){$(".yahooMoreLess").bind("click",function(){if($(".moreYahoo").css("display")=="none"){$(".moreYahoo").show();$(".yahooMoreLess").html("Less...");}else{$(".moreYahoo").hide();$(".yahooMoreLess").html("More...");}});}},showBlankState:function(){var html="Enter name or title to preview web search results for the person.";
if(this.config.inMashup){html="Enter name or title to preview web search results for the person.";}$(".yahooBossMessage").html(html);$(".yahooBossHeader , .loadingDiv").hide();$(".yahooBossData").addClass("noSearch");$(".yahooBossMessage").show();},showMatchesState:function(resp){if(resp.data==null||resp.data.length==0){if(iv.genProf.preview.config.name.length!=0){this.search_criteria='"'+iv.genProf.preview.config.name+'"';
if(iv.genProf.preview.config.title.length!=0){this.search_criteria=this.search_criteria+' and "'+iv.genProf.preview.config.title+'"';}}else{this.search_criteria='"'+iv.genProf.preview.config.title+'"';}var companyName=iv.genProf.preview.config.companyName;if(iv.genProf.isContactSearch()){companyName=$("#gen-prof-contact-company").val();
}var noDataHTML="No results found for "+this.search_criteria+' at "'+companyName+'"';$(".yahooBossRowData").addClass("noData");$(".yahooBossRowData").html(noDataHTML).show();}else{var html=_.template(iv.ui.getTemplate("company.people.yahooProfile"),{yahooData:resp.data});$(".yahooBossRowData").html(html).show();
this.attachEvents();}},showLoadingState:function(){$(".yahooBossData").removeClass("noSearch");$(".yahooBossRowData").removeClass("noData");$(".yahooBossHeader , .loadingDiv").show();$(".yahooBossMessage ,.yahooBossError, .yahooBossRowData").hide();},showErrorState:function(resp){if(typeof resp.error!="undefined"&&resp.error){$(".yahooBossError").html("Error in search and match.").show();
}},search:function(){var companyName="";this.showLoadingState();iv.genProf.preview.config.name=jQuery.trim($("#gen-prof-contact-name").val());iv.genProf.preview.config.company=jQuery.trim($("#gen-prof-contact-company").val());iv.genProf.preview.config.title=jQuery.trim($("#gen-prof-contact-title").val());
var companyId=iv.genProf.preview.config.companyId;if(iv.genProf.preview.config.name==""&&iv.genProf.preview.config.title==""){this.showBlankState();return;}if(iv.genProf.isContactSearch()){if(execMatcherData.contactCompanyData.length!=0){companyId=execMatcherData.contactCompanyData[0].id;if(jQuery.trim($("#gen-prof-contact-company").val())!=execMatcherData.contactCompanyData[0].name){companyName=jQuery.trim($("#gen-prof-contact-company").val());
companyId="";}}else{companyName=jQuery.trim($("#gen-prof-contact-company").val());companyId="";}}iv.api.userAction.getJson({resource:"/iv/yahooBoss.iv",urlParams:{methodToCall:"getYBossData",execName:iv.genProf.preview.config.name,companyId:companyId,title:iv.genProf.preview.config.title,companyName:companyName},success:function(resp){iv.genProf.preview.searchCallback(resp);
},error:function(resp){iv.genProf.preview.searchCallback(resp);}});},searchCallback:function(resp){$(".loadingDiv").hide();var $this=iv.genProf.preview;if(typeof resp.error!="undefined"&&resp.error){$this.showErrorState(resp);}else{$this.showMatchesState(resp);}}};registerNS("iv.partners.people");iv.partners.people={data:null,init:function(data){data.showPartnersLink=false;
if(data.netprospexVendorId!="-1"){data.showPartnersLink=true;}if(typeof data.contactCompanyData!="undefined"){if(data.contactCompanyData.length==0){$(".webSearch").before(iv.partners.people.partnerTemplate(true,data));$("#togglePartners").bind("click",function(){iv.partners.people.togglePartnerResults(data);
});$("#togglePartners").click();}else{$("#results-inside-view").after(iv.partners.people.partnerTemplate(true,data));$("#togglePartners").bind("click",function(){iv.partners.people.togglePartnerResults(data);});}if(!data.showPartnersLink){iv.genProf.showGenerateProfileLink();}}else{iv.hub.subscribeToEvent("FILTER_CHANGED",iv.partners.people.handleCollapse,iv.partners.people);
iv.partners.people.setPartnerResultsTemplate(data);$(".HidePartner").show();$("#partner .loadMoreMessage").show();}this.data=data;},urls:{netprospexUrl:"/iv/searchNetprospexExecs.do"},searchPartnerTemplate:"<~%if(data.showPartnersLink  && !data.isOnload){%~>"+'<div id="partner-results">'+'<a name="partner-results"></a>'+'<span class="darkgrey_txt_12px cursorpointer" id="togglePartners">'+'&nbsp;<img src="/iv/common/styles/images/icn1_arrow_toggle_0.gif"  alt="Expand/Collapse"  border="0" align="absmiddle" style="padding-bottom: 3px;padding-left:3px;vertical-align:middle">'+'&nbsp;<span style="padding-left:2px;font-weight:bold;">Partner Results</span></span><br/>'+'<span id="partners-text"></span>'+"</div>"+'<~%}%~><div style="clear:both;"></div>',resultsTemplate:'<~%if(bucketData.length > 0){%~><div id="results-<~%=id%~>" class="npPartnerResults" style="display:none;" >'+'<div class="row-set">'+'<div class="rows-header" style="border-left:0px solid #999;border-right:0px solid #999;">'+"<~%if(!hasCompany){%~>"+'		<div class="data dataCol40"><span class="header-text" style="margin-left:0px;">Name</span></div>'+'		<div class="data dataCol40"><span class="header-text">Title</span></div>'+"<~%} %~>"+"<~%if(hasCompany){%~>"+'		<div class="data dataCol25"><span class="header-text" style="margin-left:0px;">Name</span></div>'+'		<div class="data dataCol30"><span class="header-text">Title</span></div>'+'		<div class="data dataCol25"><span class="header-text">Company</span></div>'+"<~%} %~>"+'<div class="data dataCol18right"><span class="header-text">Last Updated</span></div>'+"</div>"+"<~% _.each(bucketData, function(record) { %~>"+'		<div class="rows" id="record-<~%=record.executiveId%~>">'+"		<~%if(!hasCompany){%~>"+'			<div class="data dataCol40">'+'			<span class="row-text"><a id="contactHover_<~%= record.employmentId %~>" class="bluefont" '+" <~%if(isMashUp){%~>"+'onclick="iv.partners.people.pairNPUser(<~%=record.netprospexContactId%~>, <~%=record.netprospexCompanyId%~>, <~%=isMashUp%~>);"'+' href="javascript:void(0);" '+"<~%}%~>"+" <~%if(!isMashUp){%~>"+'href="<~%=npUrl%~>?call=addExecutive&netprospexContactId=<~%=record.netprospexContactId%~>&netprospexCompanyId= <~%=record.netprospexCompanyId%~>"'+"<~%}%~>  > <~%=record.execName%~></a></span>"+"			</div>"+'			<div class="data dataCol40 '+'			<~%if(record.isBadTitle){%~>dataCaution"><span class="row-text"><span id="caution_<~%=record.employmentId%~>_title" style="float: left;"><~%=record.title%~> <img style="vertical-align:middle;" src="/iv/common/styles/images/caution.png"/></span><~%} %~>'+'			<~%if(!record.isBadTitle){%~>"><span class="row-text"><~%=record.title%~><~%} %~>'+"			</span></div>"+"		<~%} %~>"+"		<~%if(hasCompany){%~>"+'			<div class="data dataCol25">'+'			<span class="row-text"><a id="contactHover_<~%= record.employmentId %~>" class="bluefont" '+" <~%if(isMashUp){%~>"+'onclick="iv.partners.people.pairNPUser(<~%=record.netprospexContactId%~>, <~%=record.netprospexCompanyId%~>, <~%=isMashUp%~>);"'+' href="javascript:void(0);" '+"<~%}%~>"+" <~%if(!isMashUp){%~>"+'href="<~%=npUrl%~>?call=addExecutive&netprospexContactId=<~%=record.netprospexContactId%~>&netprospexCompanyId= <~%=record.netprospexCompanyId%~>"'+"<~%}%~>    ><~%=record.execName%~></a></span>"+"			</div>"+'			<div class="data dataCol30 '+'			<~%if(record.isBadTitle){%~>dataCaution"><span class="row-text"><span id="caution_<~%=record.employmentId%~>_title" style="float: left;"><~%=record.title%~> <img style="vertical-align:middle;" src="/iv/common/styles/images/caution.png"/></span><~%} %~>'+'			<~%if(!record.isBadTitle){%~>"><span class="row-text"><~%=record.title%~><~%} %~>'+"			</div></span>"+'			<div class="data dataCol25"><span class="row-text"><~%=record.companyName%~></span></div>'+"		<~%} %~>"+'		<div class="data dataCol18right '+'		<~%if(!record.isDateOfCurrentyear){%~>dataCaution"><span class="row-text"><span id="caution_<~%=record.employmentId%~>_date" style="float: right;"><~%=record.lastUpdatedDate%~> <img style="vertical-align:middle;" src="/iv/common/styles/images/caution.png"/></span><~%} %~>'+'		<~%if(record.isDateOfCurrentyear){%~>"><span class="row-text"><~%=record.lastUpdatedDate%~><~%} %~>'+"		</span></div>"+"		</div>"+"<~%}); %~>"+"</div></div><~%}%~>"+"<~%if(bucketData.length == 0) {%~>"+'<div id="results-<~%=id%~>" class="npPartnerEmptyResults"></div>'+"<~%}%~>",partnerExecTemplate:"<~%  _.each(bucket, function(record) { %~>"+" <~%if(isMashUp){%~>"+'<div class="list_item" style="padding: 2px 0pt 2px 14px;"><div class="text" style="display:inline-block;">'+'<a onclick="iv.partners.people.pairNPUser(<~%=record.netprospexContactId%~>, <~%=record.netprospexCompanyId%~>, <~%=isMashUp%~>);"'+' href="javascript:void(0);" '+"<~%}%~>"+" <~%if(!isMashUp){%~>"+'<div class="list_item"><div class="text">'+'<a href="<~%=npUrl%~>?call=addExecutive&netprospexContactId=<~%=record.netprospexContactId%~>&netprospexCompanyId= <~%=record.netprospexCompanyId%~>"'+"<~%}%~>    "+'id="partner_exec_<~%= record.employmentId %~>" class="bluefont">'+"<~%= record.execName %~></a>"+'<~%if(record.title != ""){%~>,<~%}%~>'+"</div>"+"<div><~%=record.title%~></div></div>"+"<~% }); %~>",partnerResultHeader:'<div id="partners-header">&nbsp;&nbsp;&nbsp;&nbsp;'+'<~%if(netprospexId != "-1") {%~>'+'<div id="npSummary">'+'<img alt="" src="/iv/common/styles/images/icn_netprospex_red.jpg" width="14" border="0" style="vertical-align:bottom;" height="14">&nbsp;Netprospex&nbsp;&nbsp;'+'<span id="npResultText">'+'<span class="pipe">|</span> <img src="/iv/common/styles/images/SmallLoadingAnimation.gif" style="vertical-align:bottom;"/>'+"</span>"+"</div>"+'<div class="npEmptyResults"></div>'+'<div class="iv-grid" id="npset"></div>'+"<~%}%~>"+"</div>",anchorToPartnerResults:false,handleCollapse:function(data){var partnerHead=$("#partners-header");
var img=$("#togglePartners img");img.attr("src",img.attr("src").replace("_1","_0"));partnerHead.remove();$(".HidePartner").show();if(data.eventData.count=="0"){$("#togglePartners").click();}},togglePartnerResults:function(data){var partnerHead=$("#partners-header");var img=$("#togglePartners img");if(partnerHead.length!=0){img.attr("src",img.attr("src").replace("_1","_0"));
partnerHead.remove();$(".HidePartner").show();iv.util.logUserActivity("Contacts-Partner-Results-Collapse");}else{iv.partners.people.fetchNetProspexResults(data);partnerHead.show();$(".HidePartner").hide();iv.util.logUserActivity("Contacts-Partner-Results-Expand");img.attr("src",img.attr("src").replace("_0","_1"));
}},setPartnerResultsTemplate:function(data){$("#partner").find(".bucketHeader").after(iv.partners.people.partnerTemplate(true,data));$("#togglePartners,#partner a.loadMoreMessage").bind("click",function(){iv.partners.people.togglePartnerResults(data);});},getPartnerExecs:function(){var that=iv.partners.people;
var data=that.data;var searchNameStr="";var searchCompanyStr="";var npCompanyId="-1";if($("#keywordSearch").length>0){searchNameStr=$("#keywordSearch").val().replace("Name and / or Title","");npCompanyId=data.netprospexVendorId;}iv.api.getJson({resource:this.urls.netprospexUrl,success:function(resp){that.getPartnerExecsCallback(resp,data.isMashup);
},error:function(resp){if(typeof resp!="undefined"&&resp.error){alert(resp.errorMessage);$("#bucket-partner").html('<span style="color:#999999;">0 Results</span>');}},urlParams:{call:"searchNetprospex",searchString:searchNameStr,searchCompany:searchCompanyStr,netprospexCompanyId:npCompanyId,isPeopleTab:$("#keywordSearch").length>0}});
},getPartnerExecsCallback:function(resp,isMashup){var that=iv.partners.people;var data=[];if(!resp.error){data=resp.data;for(var index=0;index<data.length;index++){var record=data[index];if(typeof record.employmentId=="undefined"){record.employmentId=index;}data[index]=record;}}var html="";if(data.length>0){html=_.template(that.partnerExecTemplate,{id:"netprospex",npUrl:this.urls.netprospexUrl,bucket:data,isMashUp:typeof isMashup!="undefined"?isMashup:false});
}else{html='<span style="color:#999999;">0 Results</span>';}$("#bucket-partner").html(html);},fetchNetProspexResults:function(data){var that=iv.partners.people;var netprospexResults=$("#results-netprospex");if($("#partners-header").length==0){var html=_.template(that.partnerResultHeader,{netprospexId:data.netprospexVendorId,mashupParam:data.isMashup?"&amp;fromMashup=true":""});
$("#partner-results").append(html);}var searchNameStr="";var searchCompanyStr="";var npCompanyId="-1";if($("#keywordSearch").length>0){searchNameStr=$("#keywordSearch").val().replace("Name and / or Title","");npCompanyId=data.netprospexVendorId;if(npCompanyId=="-1"){$("#npResultText").html('<span class="pipe">|</span><span style="color:#999999;">0 Results</span>');
return;}}else{if($("input[name=execFullName]").length>0){if(data.contact_company_name=="null"){npCompanyId=data.netprospexVendorId;searchCompanyStr=data.crm_account_name;}else{if(data.crm_account_name!=data.contact_company_name){searchCompanyStr=data.contact_company_name;}else{npCompanyId=data.netprospexVendorId;
}}searchNameStr=$("input[name=execFullName]").val();}}iv.api.getJson({resource:this.urls.netprospexUrl,success:function(resp){that.netProspexCallBack(resp,data.isMashup,searchNameStr);},error:function(resp){if(typeof resp!="undefined"&&resp.error){alert(resp.errorMessage);$("#npResultText").html('<span class="pipe">|</span><span style="color:#999999;">0 Results</span>');
}},urlParams:{call:"searchNetprospex",searchString:searchNameStr,searchCompany:searchCompanyStr,netprospexCompanyId:npCompanyId,isPeopleTab:$("#keywordSearch").length>0}});},netProspexCallBack:function(resp,isMashup,searchNameStr){var that=iv.partners.people;var data=[];var hasCompanyColumn=false;if(!resp.error){data=resp.data;
for(var index=0;index<data.length;index++){var record=data[index];if(typeof record.employmentId=="undefined"){record.employmentId=index;}if(typeof record.executiveId=="undefined"){record.executiveId=index;}if(typeof record.companyName!="undefined"){hasCompanyColumn=true;}if(typeof record.isBadTitle==="undefined"){record.isBadTitle=false;
}else{record.isBadTitle=data[index].isBadTitle;}record.isDateOfCurrentyear=true;data[index]=record;}}if(data.length>0){$("#npSummary").css("border","none").css("padding-bottom",0);var html=_.template(that.resultsTemplate,{id:"netprospex",npUrl:this.urls.netprospexUrl,bucketData:data,hasCompany:$("#keywordSearch").length==0,isMashUp:typeof isMashup!="undefined"?isMashup:false});
var html="";if(data.length>0){html='<div id="results-netprospex" class="npPartnerResults" style="display:none;" >';}else{html='<div id="results-netprospex" class="npPartnerEmptyResults"></div>';}$("#npset").html(html).css({"border":"none","float":"left","padding":"4px 0","width":"100%"});that.setupGrid(data,isMashup);
window.setTimeout(function(){$("#results-netprospex").fadeIn("slow");for(var index=0;index<data.length;index++){var record=data[index];if(record.isBadTitle){that.setUpCautionHover("caution_"+record.employmentId);}}},100);}var resultTxt="";if(data.length>0){if(data.length==1){resultTxt="1 Result";}else{if(data.length>1){resultTxt=data.length+" Results";
}}if(searchNameStr!=""){resultTxt+=' for "'+searchNameStr+'"';}$("#npResultText").html('<span class="pipe">|</span> '+resultTxt);}else{$("#npResultText").empty();var emptyMessage='0 Results found for "'+searchNameStr+'"';if($("#keywordSearch").length>0){emptyMessage+='<span class="pipe">|</span><a class="bluefont npExecViewAll" onclick="iv.partners.people.getAllPartnerSearch();"';
if(iv.partners.people.data.isMashup){emptyMessage+=' href="javascript:void(0);">View all</a>';}else{emptyMessage+=' href="#partner-results">View all</a>';}}$(".npEmptyResults").html(emptyMessage);}if(iv.partners.people.anchorToPartnerResults){window.setTimeout(function(){iv.partners.people.anchorToViewPartners();
iv.partners.people.anchorToPartnerResults=false;},2000);}},anchorToViewPartners:function(){if(iv.partners.people.data.isMashup){var contentPanelTop=$("#content_panel").scrollTop();var partnerResultsTop=$("#partner-results").position().top;$("#content_panel").scrollTop(contentPanelTop+partnerResultsTop-65);
}else{window.location=window.location.toString().split("#")[0]+"#partner-results";}},getAllPartnerSearch:function(){$("input[name=execFullName]").val("");$("#keywordSearch").addClass("helpText");$("#keywordSearch").val("Name and / or Title");this.togglePartnerResults(this.data);$("#togglePartners").click();
this.anchorToPartnerResults=true;},setupGrid:function(data,isMashup){var columns=[];if($("#keywordSearch").length==0){columns[columns.length]={name:"execName",displayName:"Name",widthInPercent:25,sortable:false,template:'<a id="contactHover_<~%=employmentId%~>" class="bluefont" '+((typeof isMashup!="undefined"&&isMashup)?'onclick="iv.partners.people.pairNPUser(<~%=netprospexContactId%~>, <~%=netprospexCompanyId%~>, true);" href="javascript:void(0);" ':'href="'+this.urls.netprospexUrl+'?call=addExecutive&netprospexContactId=<~%=netprospexContactId%~>&netprospexCompanyId=<~%=netprospexCompanyId%~>" ')+"><~%=execName%~></a>"};
columns[columns.length]={name:"title",displayName:"Title",widthInPercent:30,defaultValue:"N/A",sortable:false,template:'<~%if(row.isBadTitle){%~><span id="caution_<~%=employmentId%~>_title" class="dataCaution" style="float: left;"><~%=title%~> <img style="vertical-align:middle;" src="/iv/common/styles/images/caution.png"/></span><~%} %~>'+"<~%if(!row.isBadTitle){%~><~%=title%~><~%} %~>"};
columns[columns.length]={name:"companyName",displayName:"Company",widthInPercent:25,defaultValue:"N/A",sortable:false};}else{columns[columns.length]={name:"execName",displayName:"Name",widthInPercent:35,sortable:false,template:'<a id="contactHover_<~%=employmentId%~>" class="bluefont" '+((typeof isMashup!="undefined"&&isMashup)?'onclick="iv.partners.people.pairNPUser(<~%=netprospexContactId%~>, <~%=netprospexCompanyId%~>, true);" href="javascript:void(0);" ':'href="'+this.urls.netprospexUrl+'?call=addExecutive&netprospexContactId=<~%=netprospexContactId%~>&netprospexCompanyId=<~%=netprospexCompanyId%~>" ')+"><~%=execName%~></a>"};
columns[columns.length]={name:"title",displayName:"Title",widthInPercent:40,defaultValue:"N/A",sortable:false,template:'<~%if(row.isBadTitle){%~><span id="caution_<~%=employmentId%~>_title" class="dataCaution" style="float: left;" ><~%=title%~> <img style="vertical-align:middle;" src="/iv/common/styles/images/caution.png"/></span><~%} %~>'+"<~%if(!row.isBadTitle){%~><~%=title%~><~%} %~>"};
}columns[columns.length]={name:"lastUpdatedDate",displayName:"Last Updated",widthInPercent:21,defaultValue:"N/A",sortable:false,template:'<~%if(!row.isDateOfCurrentyear){%~><span id="caution_<~%=employmentId%~>_date" class="dataCaution" style="float: right;"><~%=lastUpdatedDate%~> <img style="vertical-align:middle;" src="/iv/common/styles/images/caution.png"/></span><~%} %~>'+"<~%if(row.isDateOfCurrentyear){%~><~%=lastUpdatedDate%~><~%} %~>"};
$("#results-netprospex").setupIvGrid({gridType:"static",gridClass:"iv-grid",colConfig:columns,filter:false,data:data,dataSourceParams:{pageNum:1,sortType:"name",sortOrder:"asc"},pager:{resultsPerPage:data.length}});$("#results-netprospex").find(".rows-header .not-sortable:last .header-text").css("float","right");
if($("#keywordSearch").length==0){$("#results-netprospex .rows .data").filter(function(index){return(index+1)%4==0;}).css("text-align","right");}else{$("#results-netprospex .rows .data").filter(function(index){return(index+1)%3==0;}).css("text-align","right");}$("#results-netprospex .rows-header .header-text").filter(function(index){return(index+1)%3==1;
}).css("margin-left","0");$("#results-netprospex .rows .data").filter(function(index){return(index+1)%3==1;}).css("padding-left","0");},showLoader:function(){if($("#hide-container").length>0){$("#hide-container").show();}else{$("#gen-prof-hide-container").show();$("#content_data_table").css({"position":"relative"});
}},hideLoader:function(){if($("#hide-container").length>0){$("#hide-container").hide();}else{$("#gen-prof-hide-container").hide();$("#content_data_table").css({"position":""});}},pairNPUser:function(npContactId,npCompanyId,isMashup){this.showLoader();if(!isMashup){window.location.href=this.urls.netprospexUrl+"?call=addExecutive&netprospexContactId="+npContactId+"&netprospexCompanyId="+npCompanyId;
}else{iv.api.getJson({resource:this.urls.netprospexUrl,success:this.pairNPCallback,error:function(resp){iv.partners.people.hideLoader();iv.partners.people.pairingInProgress=false;if(typeof resp!="undefined"&&resp.error){alert(resp.errorMessage);}},urlParams:{call:"addExecutiveFromMashup",netprospexContactId:npContactId,netprospexCompanyId:npCompanyId}});
}},pairNPCallback:function(resp){iv.partners.people.hideLoader();if(!resp.error){if(typeof iv.execMatcher!="undefined"){iv.execMatcher.doMatchExecutive(resp.data[1]);}else{$("#keywordSearch").val(resp.data[0]);$("#keywordMagnify").click();}}else{alert(resp.errorMessage);}},setUpCautionHover:function(idPrefix){var html='<div class="cautionText"> '+"<ul>"+'<li class="titleText">Warning!</li>'+'<li class="cautionDesc">This contact is not a Director or above, the title level currently covered by InsideView. You may still add it to InsideView.</li>'+"</ul>"+" </div>";
var tt=new ivTooltip({"target":$("#"+idPrefix+"_title")[0],"delay":400,"timeOut":200,"width":225,"displayCallback":function(){},content:html,"smallerFrame":false});},partnerTemplate:function(flag,data){var onLoad=false;if(!flag){onLoad=true;}var obj={"companyName":data.companyName,"showPartnersLink":typeof data.showPartnersLink!="undefined"?data.showPartnersLink:false,"isOnload":onLoad};
var html=_.template(this.searchPartnerTemplate,{data:obj});return html;}};var company={tabs:{"overview":"tabAnalysis","people":"tabPeople","buzz":"tabBuzz","familyTree":"tabFamilyTree","market":"tabCompetitors"},init:function(type,data){this[type].init(data);if(typeof type!=="undefined"){if(typeof this.tabs[type]!=="undefined"){var targTab=$("#"+this.tabs[type]);
if(targTab.hasClass("secondaryNavListItems")){targTab.removeClass("secondaryNavListItems").addClass("secondaryNavListItemSelected");}}}this.initCommonTooltips();if(typeof companyMetaData!=="undefined"){this.genericTasks(companyMetaData);}},genericTasks:function(data){this.initFollowButton(data);},initFollowButton:function(data){var followButtonConfig={followType:"button",entityType:"company",companyId:data.companyId,trackedByWatchlists:data.trackedByWatchlists,watchlistInfo:iv.user.data.genericWatchlistInfo};
iv.follow.manager.createWidgets([{"selector":"#follow-"+followButtonConfig.companyId,"config":followButtonConfig}]);},setSubMenuState:function(targetId){var t=$("#"+targetId);var tStateText=$(t.children()[0]).html();t.hide();t.css({"border-right":"0px solid"});var tmenu=t.parents(".secondaryNavMore");
if(tmenu.hasClass("secondaryNavListItems")){tmenu.removeClass("secondaryNavListItems");}if(tmenu.hasClass("secondaryNavMore")){tmenu.removeClass("secondaryNavMore").addClass("secondaryNavMoreSelected");}var tmenuId=$(tmenu[0]).attr("id");var stateHook=$("#"+tmenuId+"_stateHook");var stateCont=stateHook.find(".secondaryNavSubMenuState");
stateCont.html(tStateText);stateHook.show();tmenu.show();},initCommonTooltips:function(){var moreTickersLink=$("#moreTickersLink");var holder=$("#all_tickers");if(moreTickersLink.length>0&&holder.length>0){var content=holder.html();holder.remove();new ivTooltip({"target":"moreTickersLink","delay":100,"timeOut":100,"width":180,"displayCallback":function(){},"prefetch":false,"content":content});
}},trackIt:function(id,url){iv.api.userAction.getHtmlContent({resource:url,target:$("#add_"+id),postLoad:function(){iv.initMenus();}});}};registerNS("company.people");company.people={data:null,showPartnersLink:false,connectionFilter:null,init:function(data){this.data=data;if(this.data.backFilled==="true"){}else{return;
}if(data.netprospexVendorId>0||data.jigsawVendorId>0){this.showPartnersLink=true;}if(!iv.isMashup){var urlObject=iv.util.getURLParams(window.location);if(urlObject.id){delete urlObject.id;}if(!$.isEmptyObject(urlObject)){this.connectionFilter=urlObject;}}this.defaultActions();if(iv.isMashup){this.mashupActions();
}else{this.standaloneActions();}iv.analytics.trackPageView("/iv/companyPeopleTab.html");},mashupActions:function(){this.setupMultiSync();},standaloneActions:function(){var $this=this;if(window.location.hash!==""){window.setTimeout(function(){iv.util.logUserActivity("CompanyOverview-ConnectionWidget-SelectExec");
connections.company.people.showConnectionGraph(window.location.hash.split("#")[1],$this.data.companyId);},500);}},flushEventsMaps:function(){iv.hub.flushEvent("FILTER_COUNT_UPDATE");iv.hub.flushEvent("FILTER_CHANGED");},defaultActions:function(){this.flushEventsMaps();this.enableStopPoints();this.initLinkedInLink();
this.current=new company.people.section({type:"current",companyID:this.data.companyId,sectionContainer:$("#current"),dataSource:"/iv/getCurrentCompanyPeopleInfo.iv",publishDataEvents:["FILTER_COUNT_UPDATE"],bucketLoadingMessage:"Loading current employees...",bucketSuccessMessageTemplate:"company.people.currentHeader",render:true});
this.former=new company.people.section({type:"former",companyID:this.data.companyId,sectionContainer:$("#former"),dataSource:"/iv/getFormerCompanyPeopleInfo.iv",bucketLoadingMessage:"Loading former employees...",bucketSuccessMessageTemplate:"company.people.formerHeader"});if(typeof this.data.familyTreeId!="undefined"&&this.data.familyTreeId!=""&&this.data.familyTreeId!=null){this.family=new company.people.section({type:"family",companyID:this.data.companyId,sectionContainer:$("#family"),dataSource:"/iv/getFamilyTreeCompanyPeopleInfo.iv?fTId="+this.data.familyTreeId,bucketLoadingMessage:"Loading People across Family Tree...",bucketSuccessMessageTemplate:"company.people.familyHeader"});
}else{$("#family").remove();}$(".companyPeople").delegate(".viewAll","click",function(){if(iv.isMashup){company.forceClickAndLoad("tabPeople");}else{window.location.href=$("#tabPeople a")[0].href;}});connections.company.people.init({companyId:this.data.companyId,twitterLoggedIn:this.data.twitterLoggedIn});
company.people.filter.initAllFilters(this.data.companyId);iv.hub.subscribeToEvent("FILTER_COUNT_UPDATE",company.people.filter.resetCounts,company.people.filter);if(this.showPartnersLink){$("#partner").show();iv.partners.people.init(this.data);}var addPersonHtml=$("#generate-profile-templates").html();
$("#generate-profile-links").html(addPersonHtml);var that=this;$("#show-add-form .hover-button").bind("click",function(){var searchString=$.trim($("#keywordSearch").val());var placeholder=$.trim($("#keywordSearch").attr("placeholder"));var obj={execName:"",companyName:that.data.companyName,title:"",companyId:that.data.companyId,email:"",from:"peopleTab",callBackMethod:function(){$("#keywordMagnify").trigger("click");
}};if(searchString!=""&&searchString!=placeholder&&searchString!="Name and / or Title"){obj.execName=searchString;}require([iv.ui.getTemplate("commonRequires.addPerson")],function(){iv.addPerson.init(obj);});});},multiSyncCloseTrack:function(){iv.util.logUserActivity("Multi-Sync-Close");},initLinkedInLink:function(){var $this=this;
$(".liCurrent").bind("click",function(){var companyName=$this.data.companyNameForLinkedIn;var searchType="CP";if($(this).hasClass("liFormer")){searchType="PNC";}var keywordString="";var titleString="";var rightWord="";$(".func.filter.chkbx").each(function(c,val){var e=$(val);if(!e.attr("disabled")&&e.attr("checked")){rightWord=e.attr("name");
if(e.attr("name")=="it"){rightWord="information technology or information science";}if(e.attr("name")=="research"){rightWord="engineering or research";}if(e.attr("name")=="operations"){rightWord="operations or administration";}if(e.attr("name")=="hr"){rightWord="human resources";}if(keywordString!=""){keywordString+=" or "+rightWord;
}else{keywordString=rightWord;}if(e.attr("name")=="otherFunction"){keywordString="";}}});$(".job.filter.chkbx").each(function(c,val){var e=$(val);if(!e.attr("disabled")&&e.attr("checked")){if(e.attr("name")=="clevel"){if(titleString!=""){titleString+=" or chief ";}else{titleString="Chief";}}else{if(titleString!=""){titleString+=" or "+e.attr("name");
}else{titleString=e.attr("name");}}if(e.attr("name")=="other"){titleString="";}}});if(titleString!=""){titleString=encodeURIComponent(titleString);}else{if(keywordString!=""){keywordString=encodeURIComponent(keywordString);}}if((titleString=="")&&(keywordString=="")){var url="http://www.linkedin.com/search/fpsearch?&company="+companyName+"&currentCompany="+searchType+"&searchLocationType=Y&keepFacets=keepFacets&page_num=1&pplSearchOrigin=ADVS&viewCriteria=1&sortCriteria=R&redir=redir";
}else{if((titleString!="")&&(keywordString=="")){var url="http://www.linkedin.com/search/fpsearch?&title="+titleString+"&currentTitle="+searchType+"&company="+companyName+"&currentCompany="+searchType+"&searchLocationType=Y&keepFacets=keepFacets&page_num=1&pplSearchOrigin=ADVS&viewCriteria=1&sortCriteria=R&redir=redir";
}else{if((titleString=="")&&(keywordString!="")){var url="http://www.linkedin.com/search/fpsearch?keywords="+keywordString+"&company="+companyName+"&currentCompany="+searchType+"&searchLocationType=Y&keepFacets=keepFacets&page_num=1&pplSearchOrigin=ADVS&viewCriteria=1&sortCriteria=R&redir=redir";}else{if((titleString!="")&&(keywordString!="")){var url="http://www.linkedin.com/search/fpsearch?keywords="+keywordString+"&title="+titleString+"&currentTitle="+searchType+"&company="+companyName+"&currentCompany="+searchType+"&searchLocationType=Y&keepFacets=keepFacets&page_num=1&pplSearchOrigin=ADVS&viewCriteria=1&sortCriteria=R&redir=redir";
}}}}$(this).attr("href",url);});},enableStopPoints:function(){if(this.data.userType=="0"){$(".companyPeople").delegate(".multiSync, .sync","click",function(event){iv.stopPoint.show("crmSync");event.stopPropagation();return false;});$("#family").delegate(".loadMoreMessage","click",function(event){iv.util.logUserActivity("/show-family-tree-people-tab");
iv.stopPoint.show("familyTree");event.stopPropagation();return false;});}else{$("#family").delegate(".loadMoreMessage","click",function(){iv.util.logUserActivity("/show-family-tree-people-tab");});}},setupMultiSync:function(){$("#crm_people").delegate(".multiSync","click",function(){var multiSyncWindow=window.open("about:blank","multisync","resizable=no,scrollbars=yes,status=yes,toolbar=no,location=no,menubar=yes,width=800,height=675");
var $this=company.people;$("#multiSyncForm-filter").val(JSON.stringify($this.filter.filter));$("#multiSyncForm-id").val($this.data.companyId);$("#multiSyncForm-context").val($this.data.context);$("#multiSyncForm-accountId").val($this.data.accountId);$("#multiSyncForm-companyAlias").val(JSON.stringify($this.data.alias));
var f=$("#multiSyncForm")[0];f.target=f.target;f.submit();multiSyncWindow.focus();});}};registerNS("company.people.filter");company.people.filter={filter:{},companyId:null,targ:null,isFirstRefresh:true,initAllFilters:function(cid){var ref=this;this.isFirstRefresh=true;this.companyId=cid;$(".chkbx").attr("checked",false);
$(".default").attr("checked",true);iv.hub.registerNewEvent("FILTER_CHANGED");this.setDefaultFilters();$(".filter, .default").bind("click",function(){ref.targ=$(this);if(ref.targ.hasClass("checked")){return false;}if(ref.targ.hasClass("sort")){$(".sort").removeClass("selected");ref.targ.addClass("selected");
ref.evaluateSortByLinks();}if(ref.targ.hasClass("chkbx")){if(ref.targ.hasClass("default")){ref.handleDefaultFilters();}else{ref.evaluateCheckBoxes($(this));}}ref.stateChangeEvent();var logUrls=["PeopleTab-Filter-Change"];var targParent=ref.targ.parent()[0];if($(targParent).hasClass("toBeLoggedHook")){logUrls.push($(targParent).attr("id"));
}iv.util.logUserActivity(logUrls);});this.initSearchBox();if(!$.isEmptyObject(company.people.connectionFilter)){var filters=company.people.connectionFilter.unconnected.split("_");for(var i=0;i<filters.length;i++){var str=filters[i];this.filter[str]=false;}this.changeOnScreenFilters(filters);}this.stateChangeEvent();
},changeOnScreenFilters:function(filters){$('input[name="allPeople"]').attr("checked",false);$("input.conn").attr("checked",true);for(var i=0;i<filters.length;i++){$('input[name="'+filters[i]+'"]').attr("checked",false);}if($('input[name="personalSecondDegree"]').attr("checked")==true||$('input[name="personalSecondDegree"]').attr("checked")=="checked"){$(".hideHook").show();
}},initConnectionTooltips:function(){var target;var text;$(".filter-list-conn .countHook, .filter-list-conn .connImg").hover(function(){if($(this).hasClass("countHook")==false){target=$(this).parent().children("label");}else{target=$(this);}text=target.html();text=text.replace(/\([\d]*\)/,"");text=text+" Connections";
var html=_.template(iv.ui.getTemplate("company.people.connections_tt"),{content:text});target.fadeIn("slow",function(){target.children("span").after(html);$("#conn_tt_content").html(text);});if($(this).hasClass("countHook")==false){$("#conn_tt_content").css("left","-10px");}},function(){$("#conn_hover").remove();
});},initSearchBox:function(){var ref=this;var word;$("#keywordSearch").addClass("helpText");$("#keywordSearch").attr("value","Name and / or Title");ref.removeFilterValue("keyword");$("#keywordSearch").bind("focus",function(){word=$("#keywordSearch").val();$("#keywordSearch").removeClass("helpText");
if(word=="Name and / or Title"){$("#keywordSearch").attr("value","");}});$("#keywordSearch").bind("blur",function(){word=$("#keywordSearch").val();if(word==""){$("#keywordSearch").addClass("helpText");$("#keywordSearch").attr("value","Name and / or Title");}});$("#keywordSearch").keyup(function(event){iv.util.printToConsole("Keyword Search debug");
if(event.keyCode==13){$("#keywordMagnify").click();}else{word=$("#keywordSearch").val();if(word!=""){$(".searchCross").show();}else{$(".searchCross").hide();}}event.stopPropagation();return false;});$(".searchCross").bind("click",function(){$("#keywordSearch").addClass("helpText");$("#keywordSearch").attr("value","Name and / or Title");
$(".searchCross").hide();ref.removeFilterValue("keyword");ref.stateChangeEvent();iv.util.logUserActivity("PeopleTab-Filter-Change");});$("#keywordMagnify").bind("click",function(event){iv.util.printToConsole("keywordMagnify debug");word=$("#keywordSearch").val();if(word!="Name and / or Title"){ref.setFilterValue("keyword",word);
}else{if(word==""||word=="Name and / or Title"){ref.removeFilterValue("keyword");}}ref.stateChangeEvent();event.stopPropagation();return false;});},simulateArtificialFilter:function(){$("#keywordMagnify").click();},setDefaultFilters:function(){var ref=this;_.each($(".job,.func,.conn"),function(curr){ref.setFilterValue($(curr).attr("name"),true);
});this.setFilterValue("sort",2);this.setFilterValue("unConnected",true);},isDefaultState:function(){return $(".chkbx").filter(function(){return !$(this).hasClass("default");}).filter(":checked").length==0&&$(".default").filter(":checked").length==$(".default").length&&$("#keywordSearch").hasClass("helpText");
},setFilterValue:function(key,val){this.filter[key]=val;},removeFilterValue:function(key){var x={};_.each(this.filter,function(v,k){if(k!==key){x[k]=v;}});this.filter=x;},handleDefaultFilters:function(){var that=this;var arr=this.targ.attr("id").split("-");var list=$("."+arr[2]);if(this.targ.attr("checked")===true||this.targ.attr("checked")=="checked"){$("."+arr[2]).attr("checked",false);
this.targ.addClass("checked");if(arr[2]=="conn"){that.setFilterValue("unConnected",true);}_.each(list,function(curr){that.setFilterValue($(curr).attr("name"),true);});}else{if(this.targ.attr("checked")===false||typeof this.targ.attr("checked")==="undefined"){this.targ.attr("checked",true);}}},handleLogging:function(checkbox,type){},evaluateCheckBoxes:function(target){var that=this;
var t1=target.parent().parent().children()[0].children[0];var temp=target.parent().parent();var arr=temp.attr("class").split("-");var list=$("."+arr[2]);if(this.targ.attr("checked")===true||this.targ.attr("checked")==="checked"){if(this.targ.attr("name")=="personalFirstDegree"){$(".hideHook").show();
}var t1=this.targ.parent().parent().children()[0].children[0];var temp=this.targ.parent().parent();if($(t1).attr("checked")===true||$(t1).attr("checked")==="checked"){$(t1).attr("checked",false);$(t1).removeClass("checked");if(arr[2]=="conn"){that.removeFilterValue("unConnected");}_.each(list,function(curr){if(($(curr).attr("name"))!=(that.targ.attr("name"))){that.removeFilterValue($(curr).attr("name"));
}});}else{if($(t1).attr("checked")===false||typeof $(t1).attr("checked")==="undefined"){that.setFilterValue(this.targ.attr("name"),true);}}}else{if(this.targ.attr("checked")===false||typeof this.targ.attr("checked")==="undefined"){if(this.targ.attr("name")=="personalFirstDegree"){$(".hideHook").hide();
$("#iv-conn-1b").attr("checked",false);}$(t1).attr("checked",true);$(t1).addClass("checked");that.removeFilterValue(this.targ.attr("name"));_.each(list,function(curr){if($(curr).attr("checked")===true||$(curr).attr("checked")==="checked"){$(t1).attr("checked",false);$(t1).removeClass("checked");}});if($(t1).attr("checked")===true||$(t1).attr("checked")==="checked"){_.each(list,function(curr){that.setFilterValue($(curr).attr("name"),true);
});if(arr[2]=="conn"){that.setFilterValue("unConnected",true);}}}}},evaluateSortByLinks:function(){var $this=this;sortLinks=$(".sort");_.each(sortLinks,function(current){if($(current).hasClass("selected")){var type=$(current).attr("id").split("-");$this.setFilterValue("sort",type[1]);$("#sortByMenu #buttonText").text($(current).text());
}else{$this.removeFilterValue($(current).attr("id"));}});},resetCounts:function(data){if(this.isFirstRefresh){var resp=data.eventData;var getCount;var inputElement;this.isFirstRefresh=false;$("#job1-count").html("("+resp.clevel+")");$("#job2-count").html("("+resp.vp+")");$("#job3-count").html("("+resp.director+")");
$("#job3a-count").html("("+resp.manager+")");$("#job4-count").html("("+resp.other+")");$("#job5-count").html("("+resp.board+")");$("#func1-count").html("("+resp.sales+")");$("#func2-count").html("("+resp.marketing+")");$("#func3-count").html("("+resp.finance+")");$("#func4-count").html("("+resp.hr+")");
$("#func5-count").html("("+resp.research+")");$("#func6-count").html("("+resp.operations+")");$("#func7-count").html("("+resp.it+")");$("#func8-count").html("("+resp.otherFunction+")");$("#conn1-count-a").html("("+resp.personalFirstDegree+")");if(resp.personalFirstDegree==0){$(".hideHook").show();}$("#conn1-count-b").html("("+resp.personalSecondDegree+")");
$("#conn1-count-c").html("("+resp.personalTeam+")");$("#conn2-count").html("("+resp.coWorkers+")");$("#conn3-count").html("("+resp.prevWorkers+")");$("#conn3-count-a").html("("+resp.previousTeamCoWorker+")");$("#conn4-count").html("("+resp.refAccounts+")");$("#conn5-count").html("("+resp.education+")");
_.each($(".countHook"),function(curr){getCount=$(curr).find("span").html();if(getCount=="(0)"){inputElement=$(curr).parent().children()[0];if(($(inputElement).attr("name")=="personalFirstDegree")&&(resp.personalSecondDegree!=0)){}else{$(inputElement).attr("disabled",true);$(curr).addClass("disableFilter");
}}});}},stateChangeEvent:function(){iv.hub.publishEvent("FILTER_CHANGED",{filter:JSON.stringify(this.filter),start:0,end:4,targetCompanyId:this.companyId});}};registerNS("company.people.section");company.people.section=function(params){this.type=params.type;this.bucketLoadingMessage=params.bucketLoadingMessage;
this.bucketSuccessMessageTemplate=params.bucketSuccessMessageTemplate;this.companyID=params.companyID;this.dataSource=params.dataSource;this.container=params.sectionContainer;this.id=new Date();var rbEvent="RENDER_BUCKET_"+this.type+this.id.getTime();var lmEvent="LOAD_MORE_"+this.type+this.id.getTime();
this.bucket=new company.people.bucket({loadingEvent:["FILTER_CHANGED"],dataInputEvent:[rbEvent],fetchDataEvent:[lmEvent],container:this.container,bucketLoadingMessage:this.bucketLoadingMessage,bucketSuccessMessageTemplate:this.bucketSuccessMessageTemplate,type:this.type});var pEvents=[rbEvent];this.publishDataEvents=[];
if(typeof params.publishDataEvents!=="undefined"){this.publishDataEvents=params.publishDataEvents;}_.each(this.publishDataEvents,function(ev){pEvents.push(ev);});this.connection=new pipeClass({type:this.type,dataSource:this.dataSource,fetchDataEvents:[{"key":"FILTER_CHANGED"},{"key":lmEvent,"customHandler":function(data){this.eventData.start=data.eventData.start;
this.eventData.end=data.eventData.end;}}],publishDataEvents:pEvents});};registerNS("company.people.renderer");company.people.renderer=function(config){this.config=config;};company.people.renderer.prototype.showLoading=function(){this.container.find(".bucketFooter a").hide();this.container.find(".bucketFooter .loadingIcon").show();
};company.people.renderer.prototype.startLoading=function(e){this.container.find(".bucketHeader .bucketMessage").html(this.bucketLoadingMessage);this.container.find(".bucketHeader").show();this.container.find(".bucketFooter").show();this.container.find(".bucketContent .row").remove();this.container.find(".bucketContent").hide();
this.container.find(".bucketContent .noResultRow").hide();this.showLoading();};company.people.renderer.prototype.html="";company.people.renderer.prototype.getHtml=function(e){var html=_.template(iv.ui.getTemplate("company.people.contactHolder"),{contactResult:e.eventData.executiveInfos,type:this.type,watchlistInfo:company.people.data.watchlistInfo});
return html;};company.people.renderer.prototype.changeLabels=function(evData){var html=_.template(iv.ui.getTemplate(this.config.bucketSuccessMessageTemplate),evData);this.container.find(".bucketHeader .bucketMessage").html(html);iv.unmatchedPerson.init({callBackMethod:$.proxy(company.people.filter.stateChangeEvent,company.people.filter)});
};company.people.renderer.prototype.attachEvents=function(){var contentEle="#"+this.type+" .bucketContent";var footer="#"+this.type+" .bucketFooter";var footerLoadMore="#"+this.type+" .bucketFooter a.loadMoreMessage";var loggingType=this.type;$("#"+this.type).delegate(".loadMoreMessage","click",function(){iv.util.logUserActivity("PeopleTab-LoadMore-"+loggingType);
$(contentEle).show();if($(footerLoadMore).hasClass("show")){$(footerLoadMore).show();}else{$(footer).hide();}});};company.people.renderer.prototype.successFollowExecutive=function(resp,employmentId,executiveId){if(typeof resp!="undefined"&&typeof resp.error!="undefined"&&resp.error){if(resp.errorType=="WATCHLIST_LIMIT_EXCEED"){iv.stopPoint.show("addRecordsToWatchlist");
}else{alert(resp.errorMessage);}var id="#row_"+employmentId+"_"+executiveId;$(id+" .followLoading").hide();$(id+" .following").hide();$(id+" .follow").show();}else{var id="#row_"+employmentId+"_"+executiveId;$(id+" .followLoading").hide();$(id+" .following").show();}};company.people.renderer.prototype.errorFollowExecutive=function(resp,employmentId,executiveId){if(typeof resp!="undefined"&&typeof resp.error!="undefined"&&resp.error){if(resp.errorType=="WATCHLIST_LIMIT_EXCEED"){iv.stopPoint.show("addRecordsToWatchlist");
}else{alert(resp.errorMessage);}var id="#row_"+employmentId+"_"+executiveId;$(id+" .followLoading").hide();$(id+" .following").hide();$(id+" .follow").show();}};company.people.renderer.prototype.followExecutive=function(employmentId,executiveId,peopleWatchlistId){var $this=this;var id="#row_"+employmentId+"_"+executiveId;
$(id+" .follow").hide();$(id+" .followLoading").show();iv.api.userAction.getJson({resource:" /iv/peopleWatchlist.do",urlParams:{invoke:"addExecutive",employmentId:employmentId,execId:executiveId,pplWatchlistId:peopleWatchlistId},success:function(resp){$this.successFollowExecutive(resp,employmentId,executiveId);
},error:function(resp){$this.errorFollowExecutive(resp,employmentId,executiveId);}});};company.people.renderer.prototype.activateFollow=function(){var $this=this;$("#"+this.type+" .bucketContent a.follow").bind("click",function(){var execInfoArray=$(this).parents(".row").attr("id").split("_");var employmentId=execInfoArray[1];
var executiveId=execInfoArray[2];var peopleWatchlistId=null;for(first in iv.user.data.peopleWatchlistInfo){peopleWatchlistId=iv.user.data.peopleWatchlistInfo[first].id;}$this.followExecutive(employmentId,executiveId,peopleWatchlistId);});};company.people.renderer.prototype.startRenderingData=function(e){if(e.eventData.executiveInfos.length!=0){this.html=this.getHtml(e);
this.container.find(".bucketFooter .loadingIcon").hide();this.container.find(".bucketFooter .loadMoreMessage").hide();this.container.find(".bucketContent").append(this.html);var followMap=[];_.each(e.eventData.executiveInfos,function(result){var config={followType:"inline",entityType:"person",watchlistInfo:company.people.data.watchlistInfo,executiveId:result.executiveId,employmentId:result.employmentId,trackedByWatchlists:result.trackedByWatchlists};
followMap.push({"selector":".peopleTabFollow_"+result.employmentId+"_"+result.executiveId,"config":config});});iv.follow.manager.createWidgets(followMap);var existingRecords=this.container.find(".row.contact").length;var showLoadMore=existingRecords<e.eventData.count;if(this.container.index()==0){this.container.find(".bucketContent").show();
if(showLoadMore){this.container.find(".bucketFooter, .bucketFooter a.loadMoreMessage").show();}else{this.container.find(".bucketFooter").hide();}}else{if(this.container.find(".bucketContent").css("display")=="block"){if(showLoadMore){this.container.find(".bucketFooter, .bucketFooter a.loadMoreMessage").show();
this.container.find(".bucketFooter a.loadMoreMessage span").text("Load More");}else{this.container.find(".bucketFooter").hide();}}else{this.container.find(".bucketFooter a.loadMoreMessage").show();if(showLoadMore){this.container.find(".bucketFooter a.loadMoreMessage").addClass("show");}else{this.container.find(".bucketFooter a.loadMoreMessage").removeClass("show");
}this.attachEvents();}}if(iv.isMashup){if(typeof company.people.data.crmDeployId!="undefined"){var id=Number(company.people.data.crmDeployId);switch(id){case 1:case 4:case 6:case 17:case 3:case 10:$(".sync").show();break;default:break;}}}this.container.show();iv.initMenus();}else{if(e.eventData.executiveInfos.length==0&&e.eventData.totalCount===0){if(this.container.attr("id")!=="current"){this.container.hide();
}else{this.container.find(".bucketContent").show();this.container.find(".bucketFooter").hide();this.container.find(".bucketContent .noResultRow").show();}}if(e.eventData.executiveInfos.length==0&&e.eventData.totalCount!==0){if(this.container.attr("id")==="family"&&iv.user.data.license===0){this.container.find(".bucketContent").hide();
this.container.find(".bucketFooter").show();this.container.find(".bucketFooter .loadingIcon").hide();this.container.find(".bucketFooter .loadMoreMessage").show();this.container.find(".bucketContent .noResultRow").hide();}else{this.container.find(".bucketContent").show();this.container.find(".bucketFooter").hide();
this.container.find(".bucketContent .noResultRow").show();}}}this.changeLabels(e.eventData);};registerNS("company.people.bucket");company.people.bucket=function(config){this.config=config;this.type=this.config.type;this.bucketLoadingMessage=this.config.bucketLoadingMessage;this.bucketSuccessMessage=this.config.bucketSuccessMessage;
this.container=$(config.container);var $this=this;_.each(this.config.loadingEvent,function(v){iv.hub.subscribeToEvent(v,$this.startLoading,$this);});_.each(this.config.dataInputEvent,function(v){iv.hub.subscribeToEvent(v,$this.startRenderingData,$this);});_.each(this.config.fetchDataEvent,function(v){iv.hub.registerNewEvent(v);
});var ele=this.type;$("#"+this.type).delegate(".loadMoreMessage","click",function(){iv.util.logUserActivity("PeopleTab-LoadMore-"+ele);var loadText=$("#"+ele+" .loadMoreMessage span").text();if(loadText!="Load"){var count=$("#"+ele+" .bucketContent .row").length;_.each($this.config.fetchDataEvent,function(v){iv.hub.publishEvent(v,{start:count,end:count+9});
});$this.showLoading();}else{$("#"+ele+" .loadMoreMessage span").text("Load More");}});};company.people.bucket.prototype=new company.people.renderer();company.people.bucket.prototype.constructor=company.people.bucket;registerNS("connections.company.people");connections.company.people={modalContent:{},init:function(data){this.data=data;
this.attachEvents();},showConnectionGraph:function(empId,compId,bucket,isPrivate){if(iv.isSmallMashup){return;}var graphId="connGraph_"+empId;var connectionGraphParams={id:empId,compId:compId,bucket:bucket,isPrivate:isPrivate};iv.util.require([iv.ui.getTemplate("commonRequires.modal")],function(){iv.modal.init({content:'<div id="'+graphId+'" class="connectionGraphContainer"><div class="crossButton"></div><div style="width: 780px;height: auto;text-align: center;margin: 50px 0;"><img src="/iv/common/styles/images/LoadingAnimation.gif"/></div></div>',hide:{event:"click",target:$(".crossButton")},events:{render:function(event,api){connections.company.people.getNewConnectionGraphData(connectionGraphParams,$("#"+graphId));
var renderStartTime=new Date().getTime();$("body").data("renderStartTime",renderStartTime);iv.analytics.trackPageView("/iv/connections/modal");$(".crossButton").bind("click",function(){var renderStartTime=Number($("body").data("renderStartTime"));var hideTime=new Date().getTime();var diffInSeconds=(hideTime-renderStartTime)/1000;
iv.util.printToConsole(diffInSeconds);if(diffInSeconds>=180){iv.analytics.trackPageView("/iv/connections/modal-exceeding-three-minutes");}else{if(diffInSeconds>=60){iv.analytics.trackPageView("/iv/connections/modal-exceeding-one-minute");}else{if(diffInSeconds>=10){iv.analytics.trackPageView("/iv/connections/modal-exceeding-ten-seconds");
}}}});},hide:function(event){var $this=$(this);iv.modal.remove();}}});});},getNewConnectionGraphData:function(connectionGraphParams,graphContainer){iv.api.getJson({resource:"/iv/getExecutiveConnectionGraph.iv",urlParams:{bucket:connectionGraphParams.bucket?connectionGraphParams.bucket:"",targetCompanyId:connectionGraphParams.compId,isPrivate:connectionGraphParams.isPrivate,empId:connectionGraphParams.id,filter:JSON.stringify(company.people.filter.filter)},success:function(resp){connections.company.people.handleNewConnectionGraphCallBack(resp,graphContainer);
},error:function(resp){connections.company.people.handleNewConnectionGraphCallBack(resp,graphContainer);}});},handleNewConnectionGraphCallBack:function(resp,graphContainer){if(!resp.error){connections.graph.renderer.init({data:resp.data.executiveEmploymentInfo,caller:this},graphContainer);}return resp;
},attachEvents:function(){$(".companyPeople").delegate(".connection_info a.trigger","click",function(){iv.util.logUserActivity("PeopleTab-ConnectionsGraph");var bucket=$(this).attr("class").match(/bucket_.*/)[0].split(" ")[0].replace(/bucket_/,"");connections.company.people.showConnectionGraph($(this).attr("id"),connections.company.people.data.companyId,bucket,$(this).hasClass("private"));
});$("#container").delegate(".referralLink","click",function(){iv.util.logUserActivity("Ask-for-Referral");});},getExecConnections:function(id,cmpId,bucket,isPrivate){iv.api.getJson({resource:"/iv/getExecutiveConnectionGraph.iv",urlParams:{bucket:bucket?bucket:"",targetCompanyId:cmpId,isPrivate:isPrivate,empId:id,filter:JSON.stringify(company.people.filter.filter)},success:function(resp){connections.company.people.getExecConnectionsCallback(id,resp);
},error:function(resp){connections.company.people.getExecConnectionsCallback(id,resp);}});},getExecConnectionsCallback:function(id,resp){if(typeof resp!="undefined"&&typeof resp.error!="undefined"&&resp.error){alert(resp.errorMessage);}else{var respData=resp;var filterData=new Array();var filter=company.people.filter.filter;
if(respData.data.executiveEmploymentInfo.connectionDetailsInfos.length>0){$("#connectionName").html(respData.data.executiveEmploymentInfo.name);respData.data.executiveEmploymentInfo.container=$(".connections_modal:visible .connection-container");respData.data.executiveEmploymentInfo.cb=function(){if($(".connections_modal")[0].scrollHeight>$(".connections_modal").height()){$(".connections_modal .connection-container .backtotop").remove();
$(".connections_modal .connection-container").append(_.template(iv.ui.getTemplate("company.people.connectionsModalBackToTop"),{}));$(".connections_modal .connection-container .backtotop a").bind("click",function(){$(".connections_modal").scrollTop(0);});$(".connections_modal.connectionData").css("border-bottom","1px solid #CCCCCC");
}else{$(".connections_modal.connectionData").css("border","none");}};respData.data.executiveEmploymentInfo.isContact=true;respData.data.executiveEmploymentInfo.forceShowHeader=true;respData.data.executiveEmploymentInfo.isMashup=false;respData.data.executiveEmploymentInfo.fullName=respData.data.executiveEmploymentInfo.name;
graph=new connections.graph(respData.data.executiveEmploymentInfo);graph.render();}}}};registerNS("iv.unmatchedPerson");iv.unmatchedPerson={callBackMethod:null,init:function(params){this.callBackMethod=params.callBackMethod;this.getActiveElements();},getActiveElements:function(){$.each($("a.unmatchedInfo"),function(){var element=$(this);
if(element.data("events")==null){iv.unmatchedPerson.initToolTip(element);}});},initToolTip:function(ele){var elementId=ele.attr("id");var tabName=ele.attr("name");var personalId=elementId;var execName=ele.parent().children(".unmatched").html();require([iv.ui.getTemplate("commonRequires.toolTip")],function(){iv.toolTip.init({selector:"#"+elementId,messageContent:iv.unmatchedPerson.getLoaderHtml(personalId,execName),position:iv.unmatchedPerson.getPositionAttributes(),callBack:iv.unmatchedPerson.getToolTipHtml,callBackParams:{personalId:personalId,from:tabName},delay:500});
});},getPositionAttributes:function(){if(iv.isMashup){return{at:"right center",corner:"left center",my:"left center"};}else{return{at:"top center",corner:"bottom center",my:"bottom center"};}},getLoaderHtml:function(personalId,execName){if(iv.user.data.license==0){return _.template(iv.ui.getTemplate("personalConnectionSettings.upgradeTip"),{"execName":execName});
}else{return _.template(iv.ui.getTemplate("personalConnectionSettings.unmatchedLoaderTip"),{"personalId":personalId});}},getToolTipHtml:function(ele,params){if(iv.user.data.license!=0){iv.api.getJson({resource:"/iv/getPrivateConnectionDetailsById.iv",urlParams:{id:params.personalId},success:function(resp){iv.unmatchedPerson.getHtmlCallback(resp,params);
},error:function(resp){iv.unmatchedPerson.getHtmlCallback(resp,params);}});}},getHtmlCallback:function(resp,params){var html;if(resp.error){html=resp.errorMessage;}else{$.extend(resp.data,params);resp.data.title=resp.data.jobTitle;resp.data.execName=resp.data.firstName+" "+resp.data.lastName;html=_.template(iv.ui.getTemplate("personalConnectionSettings.unmatchedTip"),resp.data);
$("#unmatchedToolTip_"+params.personalId).html(html);this.attachToolTipEvents(params.personalId);}},attachToolTipEvents:function(personalId){$("#unmatchedToolTip_"+personalId+" .addPerson").bind("click",function(){var parent=$(this).parent(".unmatchedToolTip");var obj={execName:parent.find('[name="execName"]').val(),companyName:parent.find('[name="companyName"]').val(),title:parent.find('[name="title"]').val(),companyId:parent.find('[name="companyId"]').val(),email:parent.find('[name="email"]').val(),privateExecId:parent.find('[name="privateExecId"]').val(),from:parent.find('[name="from"]').val(),callBackMethod:iv.unmatchedPerson.callBackMethod};
require([iv.ui.getTemplate("commonRequires.addPerson")],function(){iv.addPerson.init(obj);});});}};registerNS("connections.graph.renderer");connections.graph.renderer={config:{prefetchStartConversation:true},init:function(config,graphContainer){this.config=$.extend(this.config,config,true);this.graphContainer=graphContainer;
this.processData(config.data);this.renderConnectionsGraph();},processData:function(data){this.sourceData={name:"You",image:"/iv/common/styles/images/usernoPhoto50.png"};this.targetData={name:data.name,image:data.imageUrl?data.imageUrl:"/iv/common/styles/images/usernoPhoto50.png",title:data.title,email:typeof data.execEmail!="undefined"&&$.trim(data.execEmail)!=""?data.execEmail:"",phone:typeof data.execPhoneNumber!="undefined"&&$.trim(data.execPhoneNumber)!=""?data.execPhoneNumber:"",companyTwitterHandle:typeof data.companyTwitterHandle!="undefined"&&$.trim(data.companyTwitterHandle)!=""?data.companyTwitterHandle:"",userType:iv.user.data.license,active:data.activeInTarget,isPersonal:data.employmentId<=0?true:false,employmentId:data.employmentId,companyId:data.companyId,url:"/iv/executiveinfo.do?methodToCall=overview&id="+data.employmentId,companyName:data.ckName,companyUrl:"/iv/companyinfo.do?methodToCall=overview&id="+data.companyId};
this.connections=data.connectionDetailsInfos;},getHeaderHtml:function(connectionCount){var header=_.template(iv.ui.getTemplate("connections.connectionGraph.header"),{connectionCount:connectionCount,connectionWord:connectionCount==1?"connection":"connections",targetName:this.targetData.name});return header;
},getSourceHtml:function(){var sourceHtml=_.template(iv.ui.getTemplate("connections.connectionGraph.sourceLayout"),this.sourceData);return sourceHtml;},getTargetHtml:function(){var targetHtml=_.template(iv.ui.getTemplate("connections.connectionGraph.targetLayout"),this.targetData);return targetHtml;},getConnectionsHtml:function(){var connectionsHtml="";
this.connectionObjectsArray=[];_.each(this.connections,function(connection){var connObj;if(connection.teamCoworkers.length>0){_.each(connection.teamCoworkers,function(coWorkerData){var params={connectionData:connection,sourceData:connections.graph.renderer.sourceData,targetData:connections.graph.renderer.targetData,isTeamCoWorker:true,teamCoworkerData:coWorkerData,id:connections.graph.renderer.connectionObjectsArray.length+1};
connObj=new secondDegreeObject(params);connections.graph.renderer.connectionObjectsArray.push(connObj);connectionsHtml=connectionsHtml+connObj.getHtml();});}else{if(connection.connectionDegree=="FIRSTDEGREE"){var params={connectionData:connection,sourceData:connections.graph.renderer.sourceData,targetData:connections.graph.renderer.targetData,id:connections.graph.renderer.connectionObjectsArray.length+1};
connObj=new firstDegreeObject(params);connections.graph.renderer.connectionObjectsArray.push(connObj);connectionsHtml=connectionsHtml+connObj.getHtml();}else{var params={connectionData:connection,sourceData:connections.graph.renderer.sourceData,targetData:connections.graph.renderer.targetData,id:connections.graph.renderer.connectionObjectsArray.length+1};
connObj=new secondDegreeObject(params);connections.graph.renderer.connectionObjectsArray.push(connObj);connectionsHtml=connectionsHtml+connObj.getHtml();}}});var html='<div class="greyConnectionBox">'+'		<div class="connections">'+'			<div class="scrollbar">'+'				<div class="track">'+'					<div class="thumb">'+'						<div class="end"></div>'+"					</div>"+"				</div>"+"			</div>"+'			<div class="viewport">'+'				<div class="overview">'+connectionsHtml+"				</div>"+"			</div>"+"		</div>"+"     </div>";
return html;},initializeConnectionTooltips:function(){_.each(connections.graph.renderer.connectionObjectsArray,function(connectionObj){connectionObj.initTooltip();});},renderConnectionsGraph:function(){$.fn.qtip.zindex=$.fn.qtip.plugins.modal.zindex+200;var sourceHtml=this.getSourceHtml();var targetHtml=this.getTargetHtml();
var connectionsHtml=this.getConnectionsHtml();var headerHtml=this.getHeaderHtml(connections.graph.renderer.connectionObjectsArray.length);var modalHeightClass="tall";var connectionsGraphHtml=headerHtml+'<div class="content-wrap">'+'		<div class="content '+modalHeightClass+'">'+'			<div class="page1">'+sourceHtml+connectionsHtml+targetHtml+"</div>"+'			<div class="page2">'+"</div>"+"		</div>"+"</div>";
this.graphContainer.addClass("connectionGraphContainer");this.graphContainer.html(connectionsGraphHtml);$(window).resize();this.attachTrackers(this.graphContainer);this.attachScrollHandler(this.graphContainer);this.initializeConnectionTooltips();this.attachStartConversationHook(this.graphContainer);},attachTrackers:function(container){container.find(".askForText").parents("a").bind("click",function(event){iv.util.logUserActivity("Ask-for-Referral");
iv.analytics.trackPageView("/iv/connections/ask-for-referral");});container.find(".name a").bind("click",function(event){iv.util.logUserActivity("Connection-Executive-Profiles");var isTarget=$(this).parents(".target").length>0;if(!isTarget){iv.analytics.trackPageView("/iv/connections/connector-profile");
}else{iv.analytics.trackPageView("/iv/connections/target-profile");}if(!iv.isMashup&&$(window).attr("name")=="insideview"){var href=$(this).attr("href");window.setTimeout(function(){window.location.href=href;},1000);event.stopPropagation();return false;}});},attachScrollHandler:function(container){container.find(".connections").tinyscrollbar();
container.find(".scrollbar").hide();container.find(".connections").bind("mouseenter",function(){container.find(".page1 .scrollbar").show();});container.bind("mouseleave",function(){container.find(".page1 .scrollbar").hide();});container.find(".page1 .scrollbar").bind("mousedown",function(){var target=container[0];
if(typeof target.onselectstart!="undefined"){target.onselectstart=function(){return false;};}else{target.onmousedown=function(){return false;};target.style.cursor="default";}container.addClass("noSelect");});container.bind("mouseup",function(){var target=container[0];if(typeof target.onselectstart!="undefined"){target.onselectstart=function(){return true;
};}else{target.onmousedown=function(){return true;};target.style.cursor="default";}container.removeClass("noSelect");});container.bind("mousewheel DOMMouseScroll",function(event){$(".ui-tooltip:last").filter(function(){return $(this).find(".connectionGraphContainer").length==0;}).hide();event.stopPropagation();
return false;});},attachStartConversationHook:function(container){var ref=this;if(typeof connections.startConversation!="undefined"){delete connections.startConversation.config.agents;}var trigger=container.find("#startConversation");trigger.bind("click",function(event){if(iv.user.data.license==0){iv.stopPoint.show("startConversation");
return;}trigger.parents(".connectionGraphContainer").find(".connections .scrollbar").hide();if($(this).hasClass("setup")){trigger.parents(".connectionGraphContainer").removeClass("startConversation").addClass("startConversation");}else{$(this).addClass("setup");iv.util.require([iv.ui.getTemplate("commonRequires.startConversation")],function(){trigger.parents(".connectionGraphContainer").removeClass("startConversation").addClass("startConversation");
if(!ref.config.prefetchStartConversation){connections.startConversation.init(ref);}connections.startConversation.setupPage();});}});if(ref.config.prefetchStartConversation){iv.util.require([iv.ui.getTemplate("commonRequires.startConversation")],function(){connections.startConversation.init(ref);connections.startConversation.prefetchAgents();
});}}};function firstDegreeObject(params){var connectionId=params.id;var connectionData=params.connectionData;var sourceData=params.sourceData;var targetData=params.targetData;var CONN_TYPE=["Personal","Coworkers","Previous coworkers","Reference Customer","Alumni"];var CONN_CLASS=["personalConn","coworkerConn","previousCoworkerConn","referenceConn","educationConn"];
var type;var tooltipContent="";function init(connectionData,sourceData,targetData){connectionData=connectionData;sourceData=sourceData;targetData=targetData;setConnectionType(connectionData);setTooltipContent(connectionData,sourceData,targetData);}this.getHtml=function(){return _.template(iv.ui.getTemplate("connections.connectionGraph.firstDegree.connection"),{connectionClass:CONN_CLASS[type],connectionText:CONN_TYPE[type],connectionId:connectionId,connectionSocialIcons:(type==0&&connectionData.personalNetworkIds)?connectionData.personalNetworkIds:[]});
};function setConnectionType(data){var connectionType=data.connectionType;switch(connectionType){case"PERSONAL":type=0;break;case"COMPANY":type=1;break;case"PREVIOUSCOMPANY":type=2;break;case"REFERENCE":type=3;break;case"EDUCATION":if(data.intermediateCompanyId<=0){type=4;}else{type=1;}break;}}function setTooltipContent(connectionData,sourceData,targetData){if(connectionData.connectionType!="PERSONAL"){tooltipContent=$.trim(_.template(iv.ui.getTemplate("connections.connectionGraph.firstDegree.tooltip"),{connectionData:connectionData,sourceData:sourceData,targetData:targetData,connectionType:CONN_TYPE[type]}));
}}this.initTooltip=function(){if(tooltipContent!=""){iv.util.require([iv.ui.getTemplate("commonRequires.toolTip"),iv.ui.getTemplate("commonRequires.peopleUpdates")],function(){var config={selector:$(".connectionGraphContainer .connection").filter("#"+connectionId).find(".roundIconHolder"),classes:"connections-hover",prerender:true,position:{viewport:$(".connectionGraphContainer .content"),offset:75,adjust:{y:10,x:-25}},messageContent:tooltipContent,dependencies:[],events:{render:function(event,api){var renderStartTime=new Date().getTime();
$(this).data("renderStartTime",renderStartTime);iv.util.logUserActivity("Connection-Hovers");iv.analytics.trackPageView("/iv/connections/hover-icons");},hide:function(event,api){var $this=$(this);if(!$this.hasClass("tracked")){$this.addClass("tracked");var renderStartTime=Number($(this).data("renderStartTime"));
var hideTime=new Date().getTime();var diffInSeconds=(hideTime-renderStartTime)/1000;if(diffInSeconds>=10){iv.analytics.trackPageView("/iv/connections/hovers-exceeding-ten-seconds");}else{if(diffInSeconds>=5){iv.analytics.trackPageView("/iv/connections/hovers-exceeding-five-seconds");}}}}}};iv.toolTip.init(config);
});}else{$("#"+connectionId+" .roundIconHolder").removeClass("disableHover").addClass("disableHover");}};init(connectionData,sourceData,targetData);}function secondDegreeObject(params){var connectionId=params.id;var connectionData=params.connectionData;var sourceData=params.sourceData;var targetData=params.targetData;
var isTeamCoWorker=params.isTeamCoWorker?true:false;var teamCoworkerData=params.teamCoworkerData;var CONN_TYPE=["Personal","Coworkers","Previous coworkers","Reference Customer","Alumni"];var CONN_CLASS=["personalConn","coworkerConn","previousCoworkerConn","referenceConn","educationConn"];var firstConnectionType;
var secondConnectionType;var isAskForRef=false;var firstTooltipContent="";var secondTooltipContent="";var intermediateBoxContent={};function init(connectionData,sourceData,targetData){setObjectData();}function setObjectData(){setConnectionType(connectionData);setIntermediateBoxContent();setTooltipContent();
}this.getHtml=function(){return _.template(iv.ui.getTemplate("connections.connectionGraph.secondDegree.connection"),{connectionId:connectionId,firstConnectionClass:CONN_CLASS[firstConnectionType],firstConnectionText:CONN_TYPE[firstConnectionType],firstConnectionSocialIcons:getSocialNetworkIds(firstConnectionType),secondConnectionClass:CONN_CLASS[secondConnectionType],secondConnectionText:CONN_TYPE[secondConnectionType],secondConnectionSocialIcons:getSocialNetworkIds(secondConnectionType),intermediateBoxContent:intermediateBoxContent});
};function getSocialNetworkIds(type){if(type==0){if(isTeamCoWorker&&teamCoworkerData.personalNetworkIds){return teamCoworkerData.personalNetworkIds;}else{if(connectionData.personalNetworkIds){return connectionData.personalNetworkIds;}}}return[];}function setIntermediateBoxContent(){if(isTeamCoWorker){intermediateBoxContent={image:teamCoworkerData.sourceImageUrl?teamCoworkerData.sourceImageUrl:"/iv/common/styles/images/usernoPhoto50.png",name:teamCoworkerData.firstName+" "+teamCoworkerData.lastName,title:typeof teamCoworkerData.title!="undefined"?teamCoworkerData.title:"",previousTitle:typeof teamCoworkerData.previousTitle!="undefined"?teamCoworkerData.previousTitle:"",company:connectionData.sourceCompanyName,companyUrl:"/iv/companyinfo.do?methodToCall=overview&id="+connectionData.sourceCompanyId,askForReferralString:getAskForReferralString(),isTeam:true,active:true};
}else{intermediateBoxContent={image:connectionData.sourceImageUrl?connectionData.sourceImageUrl:"/iv/common/styles/images/usernoPhoto50.png",execPageUrl:connectionData.sourceEmploymentId?"/iv/executiveinfo.do?methodToCall=overview&id="+connectionData.sourceEmploymentId:false,name:connectionData.sourceExecutiveName,active:connectionData.sourceEmploymentStatus,title:connectionData.sourceCompanyExecutiveTitle,company:connectionData.sourceCompanyName,companyUrl:"/iv/companyinfo.do?methodToCall=overview&id="+connectionData.sourceCompanyId,askForReferralString:getAskForReferralString(),isTeam:false};
}}function setConnectionType(connectionData){setFirstConnectionType(connectionData);setSecondConnectionType(connectionData);}function setFirstConnectionType(data){var connectionType=data.connectionType;switch(connectionType){case"PERSONAL":firstConnectionType=0;break;case"COMPANY":firstConnectionType=1;
break;case"PREVIOUSCOMPANY":firstConnectionType=2;break;case"REFERENCE":firstConnectionType=3;break;case"EDUCATION":if(data.intermediateCompanyId<=0){firstConnectionType=4;}else{firstConnectionType=1;}break;}}function setSecondConnectionType(data){if(typeof data.isPersonalCoWorker!="undefined"&&data.isPersonalCoWorker){secondConnectionType=0;
}else{if(data.intermediateCompanyId>0&&data.connectionType=="EDUCATION"){secondConnectionType=4;}else{if(data.intermediateCompanyId>0&&data.intermediateEmploymentStatus&&data.intermediateTargetEmploymentStatus){secondConnectionType=1;}else{if(data.intermediateCompanyId>0&&(!data.intermediateEmploymentStatus||!data.intermediateTargetEmploymentStatus)){secondConnectionType=2;
}else{if(targetCompanyId==data.sourceCompanyId&&activeInTarget){secondConnectionType=1;}else{if(targetCompanyId!=data.sourceCompanyId&&activeInTarget&&data.sourceEmploymentStatus){secondConnectionType=1;}else{if(targetCompanyId!=data.sourceCompanyId&&activeInTarget&&!data.sourceEmploymentStatus){secondConnectionType=1;
}else{if(!activeInTarget){secondConnectionType=2;}}}}}}}}}function setTooltipContent(){setFirstTooltipContent();setSecondTooltipContent();}function setFirstTooltipContent(){if(CONN_TYPE[firstConnectionType]!="Personal"){firstTooltipContent=$.trim(_.template(iv.ui.getTemplate("connections.connectionGraph.secondDegree.firstTooltip"),{connectionData:connectionData,sourceData:sourceData,targetData:targetData,connectionType:CONN_TYPE[firstConnectionType],intermediateBoxContent:intermediateBoxContent}));
}}function setSecondTooltipContent(){if(CONN_TYPE[secondConnectionType]!="Personal"){secondTooltipContent=$.trim(_.template(iv.ui.getTemplate("connections.connectionGraph.secondDegree.secondTooltip"),{connectionData:connectionData,sourceData:sourceData,targetData:targetData,connectionType:CONN_TYPE[secondConnectionType],intermediateBoxContent:intermediateBoxContent}));
}}function getAskForReferralString(){var email="";if(isTeamCoWorker){email=teamCoworkerData.workEmail;}else{email=connectionData.sourceEmploymentEmail;}if(email&&email!=""){if(firstConnectionType==0||firstConnectionType==1){var mailToString=_.template(iv.ui.getTemplate("connections.connectionGraph.secondDegree.mailToString"),{employmentEmail:email,targetName:targetData.name,targetTitle:typeof targetData.title!="undefined"&&$.trim(targetData.title)!=""?targetData.title:"",targetCompany:targetData.companyName,userName:iv.user.data.fullName});
return mailToString;}}return false;}this.initTooltip=function(){initFirstTooltip();initSecondTooltip();};function initFirstTooltip(){if(firstTooltipContent!=""){iv.util.require([iv.ui.getTemplate("commonRequires.toolTip"),iv.ui.getTemplate("commonRequires.peopleUpdates")],function(){var config={selector:$(".connectionGraphContainer .connection").filter("#"+connectionId).find(".iconSection.first .roundIconHolder"),classes:"connections-hover",prerender:true,position:{viewport:$(".connectionGraphContainer .content"),offset:75,adjust:{y:10,x:-25}},messageContent:firstTooltipContent,dependencies:[],events:{render:function(event,api){var renderStartTime=new Date().getTime();
$(this).data("renderStartTime",renderStartTime);iv.util.logUserActivity("Connection-Hovers");iv.analytics.trackPageView("/iv/connections/hover-icons");},hide:function(event,api){var $this=$(this);if(!$this.hasClass("tracked")){$this.addClass("tracked");var renderStartTime=Number($(this).data("renderStartTime"));
var hideTime=new Date().getTime();var diffInSeconds=(hideTime-renderStartTime)/1000;if(diffInSeconds>=10){iv.analytics.trackPageView("/iv/connections/hovers-exceeding-ten-seconds");}else{if(diffInSeconds>=5){iv.analytics.trackPageView("/iv/connections/hovers-exceeding-five-seconds");}}}}}};iv.toolTip.init(config);
});}else{$(".connectionGraphContainer .connection").filter("#"+connectionId).find(".iconSection.first .roundIconHolder").removeClass("disableHover").addClass("disableHover");}}function initSecondTooltip(){if(secondTooltipContent!=""){iv.util.require([iv.ui.getTemplate("commonRequires.toolTip"),iv.ui.getTemplate("commonRequires.peopleUpdates")],function(){var config={selector:$(".connectionGraphContainer .connection").filter("#"+connectionId).find(".iconSection.second .roundIconHolder"),classes:"connections-hover",prerender:true,position:{viewport:$(".connectionGraphContainer .content"),offset:75,adjust:{y:10,x:-25}},messageContent:secondTooltipContent,dependencies:[],events:{render:function(event,api){var renderStartTime=new Date().getTime();
$(this).data("renderStartTime",renderStartTime);iv.util.logUserActivity("Connection-Hovers");iv.analytics.trackPageView("/iv/connections/hover-icons");},hide:function(event,api){var $this=$(this);if(!$this.hasClass("tracked")){$this.addClass("tracked");var renderStartTime=Number($(this).data("renderStartTime"));
var hideTime=new Date().getTime();var diffInSeconds=(hideTime-renderStartTime)/1000;if(diffInSeconds>=10){iv.analytics.trackPageView("/iv/connections/hovers-exceeding-ten-seconds");}else{if(diffInSeconds>=5){iv.analytics.trackPageView("/iv/connections/hovers-exceeding-five-seconds");}}}}}};iv.toolTip.init(config);
});}else{$(".connectionGraphContainer .connection").filter("#"+connectionId).find(".iconSection.second .roundIconHolder").removeClass("disableHover").addClass("disableHover");}}init(connectionData,sourceData,targetData);return this;}(function(a){a.tiny=a.tiny||{};a.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false}};
a.fn.tinyscrollbar=function(d){var c=a.extend({},a.tiny.scrollbar.options,d);this.each(function(){a(this).data("tsb",new b(a(this),c));});return this;};a.fn.tinyscrollbar_update=function(c){return a(this).data("tsb").update(c);};function b(q,g){var k=this,t=q,j={obj:a(".viewport",q)},h={obj:a(".overview",q)},d={obj:a(".scrollbar",q)},m={obj:a(".track",d.obj)},p={obj:a(".thumb",d.obj)},l=g.axis==="x",n=l?"left":"top",v=l?"Width":"Height",r=0,y={start:0,now:0},o={},e="ontouchstart" in document.documentElement;
function c(){k.update();s();return k;}this.update=function(z){j[g.axis]=j.obj[0]["offset"+v];h[g.axis]=h.obj[0]["scroll"+v];h.ratio=j[g.axis]/h[g.axis];d.obj.toggleClass("disable",h.ratio>=1);m[g.axis]=g.size==="auto"?j[g.axis]:g.size;p[g.axis]=Math.min(m[g.axis],Math.max(0,(g.sizethumb==="auto"?(m[g.axis]*h.ratio):g.sizethumb)));
d.ratio=g.sizethumb==="auto"?(h[g.axis]/m[g.axis]):(h[g.axis]-j[g.axis])/(m[g.axis]-p[g.axis]);r=(z==="relative"&&h.ratio<=1)?Math.min((h[g.axis]-j[g.axis]),Math.max(0,r)):0;r=(z==="bottom"&&h.ratio<=1)?(h[g.axis]-j[g.axis]):isNaN(parseInt(z,10))?r:parseInt(z,10);w();};function w(){var z=v.toLowerCase();
p.obj.css(n,r/d.ratio);h.obj.css(n,-r);o.start=p.obj.offset()[n];d.obj.css(z,m[g.axis]);m.obj.css(z,m[g.axis]);p.obj.css(z,p[g.axis]);}function s(){if(!e){p.obj.bind("mousedown",i);m.obj.bind("mouseup",u);}else{j.obj[0].ontouchstart=function(z){if(1===z.touches.length){i(z.touches[0]);z.stopPropagation();
}};}if(g.scroll&&window.addEventListener){t[0].addEventListener("DOMMouseScroll",x,false);t[0].addEventListener("mousewheel",x,false);t[0].addEventListener("MozMousePixelScroll",function(z){z.preventDefault();},false);}else{if(g.scroll){t[0].onmousewheel=x;}}}function i(A){a("body").addClass("noSelect");
var z=parseInt(p.obj.css(n),10);o.start=l?A.pageX:A.pageY;y.start=z=="auto"?0:z;if(!e){a(document).bind("mousemove",u);a(document).bind("mouseup",f);p.obj.bind("mouseup",f);}else{document.ontouchmove=function(B){B.preventDefault();u(B.touches[0]);};document.ontouchend=f;}}function x(B){if(h.ratio<1){var A=B||window.event,z=A.wheelDelta?A.wheelDelta/120:-A.detail/3;
r-=z*g.wheel;r=Math.min((h[g.axis]-j[g.axis]),Math.max(0,r));p.obj.css(n,r/d.ratio);h.obj.css(n,-r);if(g.lockscroll||(r!==(h[g.axis]-j[g.axis])&&r!==0)){A=a.event.fix(A);A.preventDefault();}}}function u(z){if(h.ratio<1){if(g.invertscroll&&e){y.now=Math.min((m[g.axis]-p[g.axis]),Math.max(0,(y.start+(o.start-(l?z.pageX:z.pageY)))));
}else{y.now=Math.min((m[g.axis]-p[g.axis]),Math.max(0,(y.start+((l?z.pageX:z.pageY)-o.start))));}r=y.now*d.ratio;h.obj.css(n,-r);p.obj.css(n,y.now);}}function f(){a("body").removeClass("noSelect");a(document).unbind("mousemove",u);a(document).unbind("mouseup",f);p.obj.unbind("mouseup",f);document.ontouchmove=document.ontouchend=null;
}return c();}}(jQuery));