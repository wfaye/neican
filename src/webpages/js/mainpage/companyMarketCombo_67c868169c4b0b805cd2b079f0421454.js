registerNS("iv.follow.manager");iv.follow.manager={processItems:function(list){var $this=this;_.each(list,function(item){$this.createFollowWidgetItem(item.selector,item.config);});},createWidgets:function(list){this.processItems(list);iv.initMenus();},createFollowWidgetItem:function(selector,config){$(selector).setupFollow(config);
}};(function($){var ivFollow=function(elem,options){this.followContainer=elem;this.clickedElem=null;this.isActionActive=false;this.uid=options.uid;this.followId=options.followId;this.config={entityType:"company",followType:"inline",trackedByWatchlists:[],urls:{"follow":"/iv/followEntityInWatchlist.iv","unfollow":"/iv/unfollowEntityFromWatchlist.iv"},menuHeaderTemplate:'<div id="add_<~%=current%~>"> <ul class="menu follow-menu '+"<~% if(trackedByWatchlists.length != 0) { %~>"+"following-type-<~%=followType%~> "+"<~% } else { %~>"+"follow-type-<~%=followType%~> "+"<~% } %~>"+' ieOverride" id="wlAddMenu_<~%=uid%~>">'+"<li>"+"<~% if(trackedByWatchlists.length != 0) { %~>"+'<a class="<~% if(followType == "inline"){%~> hover-button<~% } %~>" href="javascript:void(0);">'+'<div title="Add <~%=entityType%~> to your InsideView Watchlist" class="following-<~%=followType%~>-<~%=entityType%~>">'+'<div class="new-follow-sprite followingSymbol"></div>'+'<span class="textHook float_left">Following</span>'+'<span class="new-follow-sprite track-arw-<~%=followType%~>"></span> '+"<~% } else { %~>"+' <a class="<~% if(followType == "inline"){%~> hover-button<~% } %~>" href="javascript:void(0);">'+'<div title="Add <~%=entityType%~> to your InsideView Watchlist" class="follow-<~%=followType%~>-<~%=entityType%~>">'+'<div class="new-follow-sprite followSymbol"></div>'+'<span class="textHook float_left">Follow</span> '+'<span class="new-follow-sprite float_left track-arw-<~%=followType%~>"></span> '+"<~% } %~>"+"</div>"+'<div style="clear: both; height: 0px; width: 0px;"></div></a>',menuBodyTemplate:"<ul>"+"<~%_.each(watchlistInfo , function(wlObj){%~>"+'<li style="clear:both;">'+'<~% if(wlObj["type"] == 2) { %~>'+'<~% if($.inArray(wlObj["id"],trackedByWatchlists) > -1 || $.inArray(wlObj["id"],trackedByWatchlists) != -1) { %~>'+'<a class="following-<~%=entityType%~>-freq following-entity freq-viewed-wl" id="<~%=wlObj["id"]%~>" rel="<~%=wlObj["id"]%~>"><img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle" style="visibility:visible"/>&nbsp;'+'<span><~%=wlObj["name"]%~></span></a>'+"<~%}else{%~>"+'<span class="dynamic follow" title="Frequently Viewed Watchlist - cannot add '+" <~% entityType == \"company\" ? 'companies' : 'people'; %~>"+' manually."><img width="16" height="16" align="absmiddle" style="visibility:hidden;padding-right:5px;" src="/iv/common/styles/images/checked2.png">Frequently Viewed</span>'+"<~%}%~>"+'<~%}else if(wlObj["type"] == 0){%~>'+'<~% if($.inArray(wlObj["id"],trackedByWatchlists) > -1 || $.inArray(wlObj["id"],trackedByWatchlists) != -1) { %~>'+'<a rel="<~%=wlObj["id"]%~>" href="javascript:void(0);" class="following-entity">'+'<img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle"/>&nbsp;'+"<~%}else{%~>"+'<a rel="<~%=wlObj["id"]%~>" href="javascript:void(0);" class="follow-entity">'+'<img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle" style="visibility:hidden"/>&nbsp;'+"<~%}%~>"+'<~% if(wlObj["name"].length > 17){ wlObj["name"] = wlObj["name"].substring(0,14) + "..."; %~>'+"<~%}%~>"+'<span><~%=wlObj["name"]%~></span></a>'+'<~%}else if(wlObj["type"] == 1){%~>'+'<span class="dynamic follow" title="Automated Watchlist - cannot add '+"<~% entityType == \"company\" ? 'companies' : 'people'; %~> manually.\">"+'<img src="/iv/common/styles/images/checked2.png" height="16" width="16" align="absmiddle" '+'<~% if($.inArray(wlObj["id"],trackedByWatchlists) == -1) { %~>'+'style="visibility:hidden"'+"<~%}%~>  />&nbsp;"+'<img align="absmiddle" src="/iv/common/styles/images/salesforce_logo.png" style="width:16px;height:16px;padding-right:5px;"/>'+'<~% if(wlObj["name"].length > 17){ wlObj["name"] = wlObj["name"].substring(0,14) + "..."; %~>'+"<~%}%~>"+'<~%=wlObj["name"]%~></span></li>'+"<~%}});%~>"+"<~% if(dynamicCreateWL != false) { %~>"+'<li class="createAutomatedWL">'+'<~% if(dynamicCreateWL == "enabled") { %~>'+'<a href="/iv/watchlist.iv?dynamicWatchlistEnabled=true&newSFDCWatchList=true" target="insideview">'+"<span>Create Automated Watchlist</span></a>"+"<~%} else {%~>"+'<span class="dynamic">Create Automated Watchlist</span>'+"<~%}%~>"+"</li>"+"<~%}%~>"+"</ul></li></ul></div>"};
if(typeof options!="undefined"){$.extend(true,this.config,options);}if(this.config.entityType=="company"){this.entityParams={type:"company",companyId:this.config.companyId};this.config.currentId=this.config.companyId;}else{if(this.config.entityType=="person"){this.entityParams={type:"person",employmentId:this.config.employmentId,executiveId:this.config.executiveId};
this.config.currentId=this.config.executiveId;}}this.showFollowMenu();this.attachDelegates();};ivFollow.prototype.showFollowMenu=function(){var html="";var d=new Date();var dynamicCreateWL=false;if(iv.user.data.dynamicWLEnabled!="false"&&iv.isMashup){if(_.size(iv.user.data.genericWatchlistInfo)<iv.user.data.maxWLSize){dynamicCreateWL="enabled";
}else{dynamicCreateWL="disabled";}}var trackedByWatchlists=[];_.each(this.config.trackedByWatchlists,function(watchlistId){if(watchlistId!=""){trackedByWatchlists.push(parseInt(watchlistId));}});this.config.trackedByWatchlists=trackedByWatchlists;html+=_.template(this.config.menuHeaderTemplate,{trackedByWatchlists:this.config.trackedByWatchlists,followType:this.config.followType,current:this.config.currentId,entityType:this.config.entityType,uid:this.uid});
var html2=_.template(this.config.menuBodyTemplate,{trackedByWatchlists:this.config.trackedByWatchlists,watchlistInfo:this.config.watchlistInfo,followType:this.config.followType,current:this.config.currentId,entityType:this.config.entityType,dynamicCreateWL:dynamicCreateWL});this.followContainer.html(html+html2);
};ivFollow.prototype.attachDelegates=function(){var $this=this;if($("body").hasClass("follow-entity-init")){return;}$("body").delegate("a","click",function(){var target=$(this);if(!target.hasClass("follow-entity")&&!target.hasClass("following-entity")){return;}var targEntity=iv.user.followMetaData[target.parents(".follow-menu").attr("id").split("_")[1]];
if(target.hasClass("follow-entity")&&!targEntity.isActionActive){targEntity.isActionActive=true;target.css("opacity","0.5");var wId=target.attr("rel");targEntity.clickedElem=target.find("span");target.removeClass("follow-entity").addClass("following-entity");$.extend(targEntity.entityParams,{watchlistId:wId});
targEntity.followAction("follow");}else{if(target.hasClass("following-entity")&&!targEntity.isActionActive){targEntity.isActionActive=true;target.css("opacity","0.5");var wId=target.attr("rel");targEntity.clickedElem=target.find("span");$.extend(targEntity.entityParams,{watchlistId:wId});if(target.hasClass("following-"+targEntity.config.entityType+"-freq")){target.removeClass("following-"+$this.config.entityType+"-freq").css("opacity","0.5");
target.css("cursor","normal");target.removeClass("following-entity");}else{target.removeClass("following-entity").addClass("follow-entity");}targEntity.followAction("unfollow");}}});$("body").addClass("follow-entity-init");};ivFollow.prototype.actionCallback=function(resp){this.isActionActive=false;if(resp.error==false){iv.hub.publishEvent("REFRESH_SETUP","followCompanies");
var menuId="wlAddMenu_"+this.uid;var spanText=$("#"+menuId).find(".textHook");if($(this.clickedElem).parent("a").find("img").css("visibility")=="hidden"){$(this.clickedElem).parent("a").find("img").css("visibility","visible");$(this.clickedElem).parent("a").css("opacity","1");this.config.trackedByWatchlists.splice(0,0,this.entityParams.watchlistId);
var watchlistId=$(this.clickedElem).parent("a").attr("rel");if(this.config.entityType=="company"){iv.user.data.genericWatchlistInfo[watchlistId]["companies"].push(this.followId);}else{iv.user.data.genericWatchlistInfo[watchlistId]["executives"].push(this.followId);}if(spanText.text()=="Follow"){$("#"+menuId).removeClass("follow-type-"+this.config.followType).addClass("following-type-"+this.config.followType);
spanText.text("Following");$("#"+menuId).find("div.new-follow-sprite").removeClass("followSymbol").addClass("followingSymbol");spanText.parent("div").removeClass("follow-"+this.config.followType+"-"+this.config.entityType).addClass("following-"+this.config.followType+"-"+this.config.entityType);}}else{$(this.clickedElem).parent("a").find("img").css("visibility","hidden");
if($(this.clickedElem).parent("a").hasClass("freq-viewed-wl")){$(this.clickedElem).parent("a").css("opacity","0.5");}else{$(this.clickedElem).parent("a").css("opacity","1");}var index=$.inArray(this.entityParams.watchlistId,this.config.trackedByWatchlists);this.config.trackedByWatchlists.splice(index,1);
var watchlistId=$(this.clickedElem).parent("a").attr("rel");if(this.config.entityType=="company"){iv.user.data.genericWatchlistInfo[watchlistId]["companies"]=_.without(iv.user.data.genericWatchlistInfo[watchlistId]["companies"],this.followId);}else{iv.user.data.genericWatchlistInfo[watchlistId]["executives"]=_.without(iv.user.data.genericWatchlistInfo[watchlistId]["executives"],this.followId);
}if(spanText.text()=="Following"&&this.config.trackedByWatchlists.length==0){$("#"+menuId).removeClass("following-type-"+this.config.followType).addClass("follow-type-"+this.config.followType);spanText.text("Follow");$("#"+menuId).find("div.new-follow-sprite").removeClass("followingSymbol").addClass("followSymbol");
spanText.parent("div").removeClass("following-"+this.config.followType+"-"+this.config.entityType).addClass("follow-"+this.config.followType+"-"+this.config.entityType);}}}else{if(resp.error==true){this.isActionActive=false;if($(this.clickedElem).parent("a").hasClass("following-entity")){$(this.clickedElem).parent("a").removeClass("following-entity").addClass("follow-entity");
}else{$(this.clickedElem).parent("a").removeClass("follow-entity").addClass("following-entity");}$(this.clickedElem).parent("a").css("opacity","1");if(resp.errorType="WatchlistLimitError"){iv.stopPoint.show("addRecordsToWatchlist");}}}};ivFollow.prototype.followAction=function(followtype){var $this=this;
iv.api.userAction.getJson({resource:this.config.urls[followtype],urlParams:this.entityParams,success:function(resp){$this.actionCallback(resp);},error:function(resp){$this.actionCallback(resp);}});};$.fn.setupFollow=function(options){var ts=iv.util.getUniqueId();if(typeof options.companyId!=="undefined"){var uid=options.companyId+ts;
var followId=options.companyId;}else{var uid=options.executiveId+options.employmentId+ts;var followId=options.executiveId;}options["uid"]=uid;options["followId"]=followId;registerNS("iv.user.followMetaData");iv.user.followMetaData[uid]=new ivFollow(this,options);return iv.user.followMetaData[uid];};})(jQuery);
var company={tabs:{"overview":"tabAnalysis","people":"tabPeople","buzz":"tabBuzz","familyTree":"tabFamilyTree","market":"tabCompetitors"},init:function(type,data){this[type].init(data);if(typeof type!=="undefined"){if(typeof this.tabs[type]!=="undefined"){var targTab=$("#"+this.tabs[type]);if(targTab.hasClass("secondaryNavListItems")){targTab.removeClass("secondaryNavListItems").addClass("secondaryNavListItemSelected");
}}}this.initCommonTooltips();if(typeof companyMetaData!=="undefined"){this.genericTasks(companyMetaData);}},genericTasks:function(data){this.initFollowButton(data);},initFollowButton:function(data){var followButtonConfig={followType:"button",entityType:"company",companyId:data.companyId,trackedByWatchlists:data.trackedByWatchlists,watchlistInfo:iv.user.data.genericWatchlistInfo};
iv.follow.manager.createWidgets([{"selector":"#follow-"+followButtonConfig.companyId,"config":followButtonConfig}]);},setSubMenuState:function(targetId){var t=$("#"+targetId);var tStateText=$(t.children()[0]).html();t.hide();t.css({"border-right":"0px solid"});var tmenu=t.parents(".secondaryNavMore");
if(tmenu.hasClass("secondaryNavListItems")){tmenu.removeClass("secondaryNavListItems");}if(tmenu.hasClass("secondaryNavMore")){tmenu.removeClass("secondaryNavMore").addClass("secondaryNavMoreSelected");}var tmenuId=$(tmenu[0]).attr("id");var stateHook=$("#"+tmenuId+"_stateHook");var stateCont=stateHook.find(".secondaryNavSubMenuState");
stateCont.html(tStateText);stateHook.show();tmenu.show();},initCommonTooltips:function(){var moreTickersLink=$("#moreTickersLink");var holder=$("#all_tickers");if(moreTickersLink.length>0&&holder.length>0){var content=holder.html();holder.remove();new ivTooltip({"target":"moreTickersLink","delay":100,"timeOut":100,"width":180,"displayCallback":function(){},"prefetch":false,"content":content});
}},trackIt:function(id,url){iv.api.userAction.getHtmlContent({resource:url,target:$("#add_"+id),postLoad:function(){iv.initMenus();}});}};registerNS("company.market");company.market={data:null,init:function(data){this.data=data;$("#export").hide();this.initFollowMenus();},initFollowMenus:function(){var followMap=[];
for(var i=0;i<this.data["companyData"].length;i++){var config={followType:"inline",entityType:"company",watchlistInfo:iv.user.data.genericWatchlistInfo,companyId:this.data["companyData"][i].id,trackedByWatchlists:this.data["companyData"][i].trackingIds};followMap.push({"selector":"#marketFollow_"+this.data["companyData"][i].id,"config":config});
}iv.follow.manager.createWidgets(followMap);}};iv.processOnDomReady(function(){company.init("market",companyMarketdata);});